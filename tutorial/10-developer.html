<!DOCTYPE html>
<html>

  <head>
  

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <!-- Begin Jekyll SEO tag v2.6.1 -->
<title>Develop Smart Behaviour | BRAIN-IoT</title>
<meta name="generator" content="Jekyll v4.1.1" />
<meta property="og:title" content="Develop Smart Behaviour" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Summary" />
<meta property="og:description" content="Summary" />
<meta property="og:site_name" content="BRAIN-IoT" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2021-02-11T13:53:40+00:00" />
<script type="application/ld+json">
{"description":"Summary","@type":"BlogPosting","headline":"Develop Smart Behaviour","dateModified":"2021-02-11T13:53:40+00:00","datePublished":"2021-02-11T13:53:40+00:00","url":"/brain-iot-tutorials/tutorial/10-developer.html","mainEntityOfPage":{"@type":"WebPage","@id":"/brain-iot-tutorials/tutorial/10-developer.html"},"@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->


  <link href="//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css" rel="stylesheet" />
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>

  <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css" />
  <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/vbnet.min.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/yaml.min.js"></script>

  <!-- Overridden theme -->
  <link rel="stylesheet" href="/brain-iot-tutorials/css/main.css" />

  <!-- Latest compiled and minified CSS -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous" />

  <!-- Optional theme -->
  <!-- <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css" integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous" /> -->
  <!-- Bootstrap override -->
  <link rel="stylesheet" href="/brain-iot-tutorials/css/bootstrap-override.css" />

  <link rel="alternate" type="application/rss+xml" title="BRAIN-IoT" href="/feed.xml" />

  <link rel="shortcut icon" href="/brain-iot-tutorials/img/favicon.ico" />
</head>


  <body>
    

    <div class="container">

      <header class="site-header">


<a class="site-title" href="/brain-iot-tutorials/"><img src="/brain-iot-tutorials/img/BRAIN-IoT_Logo.png" alt="BRAIN-IoT" height="75" width="154" /></a>

    <nav class="site-nav">
      <img class="menu-icon" src="/brain-iot-tutorials/img/gi.svg" />
      
      <div class="trigger">
      	<!--<a class="page-link" href="/brain-iot-tutorials/">Welcome</a>-->
        <!-- get current page title and "collection" to figure out which nav
             link should be "active" -->
        
        
        
        
          
            
              
            
          
        
          
            
              
            
          
        
          
            
              
            
          
        
          
            
              
                
                  <a class="page-link" href="/brain-iot-tutorials/tutorial/">Tutorials</a>
                
              
            
          
        
        </div>
      </div>

    </nav>

</header>


      <div class="page-content">
        <!--div class="wrapper"-->
          <div class="container-fluid">

<div class="row-fluid">
    <!--Nav Bar -->
    <nav class="col-xs-0 col-md-3 bs-docs-sidebar">
    <ul id="sidebar" class="nav nav-stacked fixed">
        <!-- Find the h2 group and any h3 subgroups -->
        

        
          

          
            
            
            
            
            <li>
              <a href="#summary">Summary</a>

              

            </li>
          

        
          

          
            
            
            
            
            <li>
              <a href="#build-and-run">Build and Run</a>

              
                <ul class="nav nav-stacked">
                  

                  
                    
                    
                    
                    
                    
                    <li>
                        <a href="#building-the-example">Building the example</a>
                    </li>
                  
                    
                    
                    
                    
                    
                    <li>
                        <a href="#running-the-example">Running the example</a>
                    </li>
                  

                </ul>
              

            </li>
          

        
          

          
            
            
            
            
            <li>
              <a href="#recreate-a-smart-behaviour">Recreate a Smart Behaviour</a>

              
                <ul class="nav nav-stacked">
                  

                  
                    
                    
                    
                    
                    
                    <li>
                        <a href="#project-setup">Project Setup</a>
                    </li>
                  
                    
                    
                    
                    
                    
                    <li>
                        <a href="#create-light-api-module">Create Light API Module</a>
                    </li>
                  
                    
                    
                    
                    
                    
                    <li>
                        <a href="#create-light-smart-behaviour-implementation-module">Create Light Smart Behavi...</a>
                    </li>
                  

                </ul>
              

            </li>
          

        
          

          
            
            
            
            
            <li>
              <a href="#build">Build</a>

              
                <ul class="nav nav-stacked">
                  

                  
                    
                    
                    
                    
                    
                    <li>
                        <a href="#smart-behaviour">Smart Behaviour</a>
                    </li>
                  

                </ul>
              

            </li>
          

        
          

          
            
            
            
            
            <li>
              <a href="#create-the-sensor-and-controller-smart-behaviours">Create the Sensor and Con...</a>

              
                <ul class="nav nav-stacked">
                  

                  
                    
                    
                    
                    
                    
                    <li>
                        <a href="#create-sensor-api-module">Create Sensor API Module</a>
                    </li>
                  
                    
                    
                    
                    
                    
                    <li>
                        <a href="#create-sensor-implementation-module">Create Sensor Implementat...</a>
                    </li>
                  
                    
                    
                    
                    
                    
                    <li>
                        <a href="#create-controller-implementation-module">Create Controller Impleme...</a>
                    </li>
                  

                </ul>
              

            </li>
          

        
          

          
            
            
            
            
            <li>
              <a href="#build-the-system">Build the System</a>

              

            </li>
          

        
          

          
            
            
            
            
            <li>
              <a href="#the-composite-application">The Composite Application</a>

              
                <ul class="nav nav-stacked">
                  

                  
                    
                    
                    
                    
                    
                    <li>
                        <a href="#dependencies-5">Dependencies</a>
                    </li>
                  
                    
                    
                    
                    
                    
                    <li>
                        <a href="#define-runtime-entity">Define Runtime Entity</a>
                    </li>
                  

                </ul>
              

            </li>
          

        
          

          
            
            
            
            
            <li>
              <a href="#create-a-marketplace">Create a Marketplace</a>

              
                <ul class="nav nav-stacked">
                  

                  
                    
                    
                    
                    
                    
                    <li>
                        <a href="#dependencies-6">Dependencies</a>
                    </li>
                  
                    
                    
                    
                    
                    
                    <li>
                        <a href="#build-1">Build</a>
                    </li>
                  
                    
                    
                    
                    
                    
                    <li>
                        <a href="#deploy-marketplace-to-a-local-http-server">Deploy Marketplace to a L...</a>
                    </li>
                  
                    
                    
                    
                    
                    
                    <li>
                        <a href="#deploy-to-a-nexus-server">Deploy to a Nexus server</a>
                    </li>
                  

                </ul>
              

            </li>
          

        
          

          
            
            
            
            
            <li>
              <a href="#end">End</a>

              

            </li>
          

        
    </ul>
</nav>


    <!--Main Content -->
    <div class="col-xs-12 col-md-9">
      <!--<div class="post">-->

        <article class="post-content">


          <a class=nav-prev href="05-quickstart.html" >Prev</a>
          <a class=nav-next href="20-distributed.html" >Next</a>
          <hr />
          <br />
          <h1>Develop Smart Behaviour</h1>
          <br />

          <p>
</p>

          <p></p>

          <h2 id="summary">Summary</h2>

<p>This tutorial will show how to create and package a simple BRAIN-IoT Smart Behaviour. It’s This tutorial is Maven and command-line based.</p>

<p>Here we will create a Security Light System which is composed of three smart behaviours: a <code class="language-plaintext highlighter-rouge">light</code>, a <code class="language-plaintext highlighter-rouge">sensor</code> and a <code class="language-plaintext highlighter-rouge">controller</code>. The sensor and light are ‘virtual’ and implemented as web pages.</p>

<p>In this tutorial we’ll first run, and then re-create and re-run, Security Light System.</p>

<p>A Smart Behaviour is a functional unit deployable in an OSGi container, and it’s built using the BRAIN-IoT <code class="language-plaintext highlighter-rouge">smart-behaviour-maven-plugin</code> plugin, different smart behaviours communicate through the <code class="language-plaintext highlighter-rouge">BRAIN-IoT Events</code> deliveried in the distributed <code class="language-plaintext highlighter-rouge">BRAIN-IoT EventBus</code>.</p>

<h2 id="build-and-run">Build and Run</h2>

<p>Download the <a href="https://git.repository-pert.ismb.it/BRAIN-IoT/SmartBehaviourEventBus.git" target="_blank">SmartBehaviourEventBus</a> Git repository, and change directory into <code class="language-plaintext highlighter-rouge">brain-iot-EventBus/eventing-example</code>.</p>

<div class="language-plaintext shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>~ $ git clone https://github.com/eclipse-researchlabs/brain-iot-EventBus.git
~ $ cd brain-iot-EventBus/eventing-example
</code></pre></div></div>

<h3 id="building-the-example">Building the example</h3>
<p>Build the Application with the following command:</p>

<div class="language-plaintext shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>~/brain-iot-EventBus/eventing-example $ mvn verify
</code></pre></div></div>
<h3 id="running-the-example">Running the example</h3>

<div class="language-plaintext shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>~/brain-iot-EventBus/eventing-example $ java -jar single-framework-example/target/single-framework-example.jar
</code></pre></div></div>
<p>To test that the application is running, visit:</p>

<p>Sensor UI: <a href="http://localhost:8080/sensor-ui/index.html" target="_blank">http://localhost:8080/sensor-ui/index.html</a></p>

<p>Light UI: <a href="http://localhost:8080/light-ui/index.html" target="_blank">http://localhost:8080/light-ui/index.html</a></p>

<p>Click the <code class="language-plaintext highlighter-rouge">Trigger the sensor</code> button in sensor page, you will see the virtual lightbulb is switched on, then slowly dims in response to a sensor event.</p>

<h2 id="recreate-a-smart-behaviour">Recreate a Smart Behaviour</h2>

<p>We’ll now recreate the Security Light example locally using the <a href="https://enroute.osgi.org/about/112-enRoute-Archetypes.html" target="_blank">enRoute Archetypes</a> this tutorial to walk through the creation of a REST Microservice comprised of the following structural elements:</p>

<ul>
  <li>An API module (light.api)</li>
  <li>A Implementation module, also including the REST Service Implementation of the light blub (light.impl)</li>
</ul>

<p>with each module having a POM that describes its dependencies.</p>

<h3 id="project-setup">Project Setup</h3>
<p>First change into a new directory, since we are recreating the project, here we go to the <code class="language-plaintext highlighter-rouge">HOME</code> directory:</p>

<div class="language-plaintext shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>~/brain-iot-EventBus/eventing-example $ cd ~
</code></pre></div></div>
<p>Use the <a href="https://enroute.osgi.org/about/112-enRoute-Archetypes.html#the-project-archetype" target="_blank">bare-project Archetype</a> to create a microservice project:</p>

<div class="language-plaintext shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>~ $ mvn archetype:generate \
     -DarchetypeGroupId=org.osgi.enroute.archetype \
     -DarchetypeArtifactId=project-bare \
     -DarchetypeVersion=7.0.0
</code></pre></div></div>
<p>Filling the project details with appropriate values:</p>

<div class="language-plaintext shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Define value for property 'groupId': com.paremus.brain.iot.example
Define value for property 'artifactId': eventing-example
Define value for property 'version' 1.0-SNAPSHOT: : 0.0.1-SNAPSHOT
Define value for property 'package' com.paremus.brain.iot.example: : 
Confirm properties configuration:
groupId: com.paremus.brain.iot.example
artifactId: eventing-example
version: 0.0.1-SNAPSHOT
package: com.paremus.brain.iot.example
 Y: :
</code></pre></div></div>
<p class="note">If you’re using an IDE then this would be a good time to import the generated maven project and then import the submodules when they’re created.</p>

<p>This is a maven parent project, which will contain multiple modules for the Security Light example.</p>

<p>Open POM and change the default <code class="language-plaintext highlighter-rouge">&lt;bnd.version&gt;</code> property to avoid build failure:</p>
<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="nt">&lt;bnd.version&gt;</span>5.1.2<span class="nt">&lt;/bnd.version&gt;</span>
</code></pre></div></div>
<p>Before implementing the module, append the following BRAIN-IoT runtime dependencies in the <code class="language-plaintext highlighter-rouge">&lt;dependencyManagement&gt;</code> section in parent POM, as they are the dependencies of EventBus.</p>

<p class="warning">Here assume that you have run through the <a href="00-prerequisites.html">Prerequisites</a> tutorial and the credentials setup for BRAIN-IoT private Nexus repositories has been done.</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="nt">&lt;dependency&gt;</span>
      <span class="nt">&lt;groupId&gt;</span>com.paremus.brain.iot<span class="nt">&lt;/groupId&gt;</span>
      <span class="nt">&lt;artifactId&gt;</span>eventing.api<span class="nt">&lt;/artifactId&gt;</span>
      <span class="nt">&lt;version&gt;</span>0.0.1-SNAPSHOT<span class="nt">&lt;/version&gt;</span>
  <span class="nt">&lt;/dependency&gt;</span>
  <span class="nt">&lt;dependency&gt;</span>
       <span class="nt">&lt;groupId&gt;</span>org.apache.aries.jax.rs<span class="nt">&lt;/groupId&gt;</span>
       <span class="nt">&lt;artifactId&gt;</span>org.apache.aries.jax.rs.jackson<span class="nt">&lt;/artifactId&gt;</span>
       <span class="nt">&lt;version&gt;</span>1.0.2<span class="nt">&lt;/version&gt;</span>
       <span class="nt">&lt;scope&gt;</span>runtime<span class="nt">&lt;/scope&gt;</span>
  <span class="nt">&lt;/dependency&gt;</span>
  <span class="nt">&lt;dependency&gt;</span>
       <span class="nt">&lt;groupId&gt;</span>com.paremus.brain.iot<span class="nt">&lt;/groupId&gt;</span>
       <span class="nt">&lt;artifactId&gt;</span>eventing.impl<span class="nt">&lt;/artifactId&gt;</span>
       <span class="nt">&lt;version&gt;</span>0.0.1-SNAPSHOT<span class="nt">&lt;/version&gt;</span>
       <span class="nt">&lt;scope&gt;</span>runtime<span class="nt">&lt;/scope&gt;</span>
  <span class="nt">&lt;/dependency&gt;</span>
       <span class="nt">&lt;dependency&gt;</span>
       <span class="nt">&lt;groupId&gt;</span>com.paremus.brain.iot<span class="nt">&lt;/groupId&gt;</span>
       <span class="nt">&lt;artifactId&gt;</span>message.integrity.insecure.impl<span class="nt">&lt;/artifactId&gt;</span>
       <span class="nt">&lt;version&gt;</span>0.0.1-SNAPSHOT<span class="nt">&lt;/version&gt;</span>
       <span class="nt">&lt;scope&gt;</span>runtime<span class="nt">&lt;/scope&gt;</span>
  <span class="nt">&lt;/dependency&gt;</span>
   <span class="nt">&lt;dependency&gt;</span>
       <span class="nt">&lt;groupId&gt;</span>org.apache.aries.spec<span class="nt">&lt;/groupId&gt;</span>
       <span class="nt">&lt;artifactId&gt;</span>org.apache.aries.javax.jax.rs-api<span class="nt">&lt;/artifactId&gt;</span>
       <span class="nt">&lt;version&gt;</span>1.0.1<span class="nt">&lt;/version&gt;</span>
       <span class="nt">&lt;scope&gt;</span>compile<span class="nt">&lt;/scope&gt;</span>
   <span class="nt">&lt;/dependency&gt;</span>
</code></pre></div></div>
<p>Append the following repositories in <code class="language-plaintext highlighter-rouge">&lt;repositories&gt;</code> section for downloading the BRAIN-IoT runtime dependencies:</p>
<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>      <span class="nt">&lt;repository&gt;</span>
            <span class="nt">&lt;id&gt;</span>brain-iot-releases<span class="nt">&lt;/id&gt;</span>
            <span class="nt">&lt;name&gt;</span>BRAIN-IoT Releases<span class="nt">&lt;/name&gt;</span>
            <span class="nt">&lt;url&gt;</span>https://nexus.repository-pert.ismb.it/repository/maven-releases/<span class="nt">&lt;/url&gt;</span>
            <span class="nt">&lt;releases&gt;</span>
                <span class="nt">&lt;enabled&gt;</span>true<span class="nt">&lt;/enabled&gt;</span>
            <span class="nt">&lt;/releases&gt;</span>
            <span class="nt">&lt;snapshots&gt;</span>
                <span class="nt">&lt;enabled&gt;</span>false<span class="nt">&lt;/enabled&gt;</span>
            <span class="nt">&lt;/snapshots&gt;</span>
        <span class="nt">&lt;/repository&gt;</span>
        <span class="nt">&lt;repository&gt;</span>
            <span class="nt">&lt;id&gt;</span>brain-iot-snapshots<span class="nt">&lt;/id&gt;</span>
            <span class="nt">&lt;name&gt;</span>BRAIN-IoT Snapshots<span class="nt">&lt;/name&gt;</span>
            <span class="nt">&lt;url&gt;</span>https://nexus.repository-pert.ismb.it/repository/maven-snapshots/<span class="nt">&lt;/url&gt;</span>
            <span class="nt">&lt;releases&gt;</span>
                <span class="nt">&lt;enabled&gt;</span>false<span class="nt">&lt;/enabled&gt;</span>
            <span class="nt">&lt;/releases&gt;</span>
            <span class="nt">&lt;snapshots&gt;</span>
                <span class="nt">&lt;enabled&gt;</span>true<span class="nt">&lt;/enabled&gt;</span>
            <span class="nt">&lt;/snapshots&gt;</span>
       <span class="nt">&lt;/repository&gt;</span>
</code></pre></div></div>
<p>and append the following plugin repositories in <code class="language-plaintext highlighter-rouge">&lt;pluginRepositories&gt;</code> section for downloading the BRAIN-IoT <code class="language-plaintext highlighter-rouge">smart-behaviour-maven-plugin</code>:</p>
<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>        <span class="nt">&lt;pluginRepository&gt;</span>
            <span class="nt">&lt;id&gt;</span>brain-iot-releases<span class="nt">&lt;/id&gt;</span>
            <span class="nt">&lt;name&gt;</span>BRAIN-IoT Releases<span class="nt">&lt;/name&gt;</span>
            <span class="nt">&lt;url&gt;</span>https://nexus.repository-pert.ismb.it/repository/maven-releases/<span class="nt">&lt;/url&gt;</span>
            <span class="nt">&lt;releases&gt;</span>
                <span class="nt">&lt;enabled&gt;</span>true<span class="nt">&lt;/enabled&gt;</span>
            <span class="nt">&lt;/releases&gt;</span>
            <span class="nt">&lt;snapshots&gt;</span>
                <span class="nt">&lt;enabled&gt;</span>false<span class="nt">&lt;/enabled&gt;</span>
            <span class="nt">&lt;/snapshots&gt;</span>
        <span class="nt">&lt;/pluginRepository&gt;</span>
        <span class="nt">&lt;pluginRepository&gt;</span>
            <span class="nt">&lt;id&gt;</span>brain-iot-snapshots<span class="nt">&lt;/id&gt;</span>
            <span class="nt">&lt;name&gt;</span>BRAIN-IoT Snapshots<span class="nt">&lt;/name&gt;</span>
            <span class="nt">&lt;url&gt;</span>https://nexus.repository-pert.ismb.it/repository/maven-snapshots/<span class="nt">&lt;/url&gt;</span>
            <span class="nt">&lt;releases&gt;</span>
                <span class="nt">&lt;enabled&gt;</span>false<span class="nt">&lt;/enabled&gt;</span>
            <span class="nt">&lt;/releases&gt;</span>
            <span class="nt">&lt;snapshots&gt;</span>
                <span class="nt">&lt;enabled&gt;</span>true<span class="nt">&lt;/enabled&gt;</span>
            <span class="nt">&lt;/snapshots&gt;</span>
        <span class="nt">&lt;/pluginRepository&gt;</span>
</code></pre></div></div>
<h3 id="create-light-api-module">Create Light API Module</h3>

<p>Change directory into the newly created <code class="language-plaintext highlighter-rouge">eventing-example</code> project directory, then create an API module <code class="language-plaintext highlighter-rouge">light.api</code> using the <a href="https://enroute.osgi.org/about/112-enRoute-Archetypes.html#the-api-archetype" target="_blank">api Archetype</a> as shown:</p>

<div class="language-plaintext shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>~ $ cd eventing-example
~/eventing-example $ mvn archetype:generate \
     -DarchetypeGroupId=org.osgi.enroute.archetype \
     -DarchetypeArtifactId=api \
     -DarchetypeVersion=7.0.0
</code></pre></div></div>
<p>with the following values:</p>

<div class="language-plaintext shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Define value for property 'groupId': com.paremus.brain.iot.example
Define value for property 'artifactId': light.api
Define value for property 'version' 1.0-SNAPSHOT: : 0.0.1-SNAPSHOT
Define value for property 'package' com.paremus.brain.iot.example.light.api: : 
Confirm properties configuration:
groupId: com.paremus.brain.iot.example
artifactId: light.api
version: 0.0.1-SNAPSHOT
package: com.paremus.brain.iot.example.light.api
 Y: :
</code></pre></div></div>
<p>This API module defines a sort of BRAIN-IoT Events via the use of <a href="https://enroute.osgi.org/FAQ/420-dtos.html" target="_blank">Data Transfer Objects (DTOs)</a> transfered between <code class="language-plaintext highlighter-rouge">light</code> smart behaviour and others. Each event has to extend the common super-type <code class="language-plaintext highlighter-rouge">BrainIoTEvent</code> shown in the following <code class="language-plaintext highlighter-rouge">BrainIoTEvent.java</code> which contains information that must exist for all events.</p>

<p>
  <a class="btn btn-primary" data-toggle="collapse" href="#BrainIoTEvent" aria-expanded="false" aria-controls="BrainIoTEvent.java">BrainIoTEvent.java</a>
</p>

<div class="collapse" id="BrainIoTEvent">
  <div class="card card-block">

<figure class="highlight"><pre><code class="language-properties" data-lang="properties"><span class="err">/*</span> <span class="err">Copyright</span> <span class="err">2019</span> <span class="err">Paremus,</span> <span class="err">Ltd</span> <span class="err">-</span> <span class="err">All</span> <span class="err">Rights</span> <span class="err">Reserved</span>
 <span class="err">*</span> <span class="err">Unauthorized</span> <span class="err">copying</span> <span class="err">of</span> <span class="err">this</span> <span class="err">file,</span> <span class="err">via</span> <span class="err">any</span> <span class="err">medium</span> <span class="err">is</span> <span class="err">strictly</span> <span class="err">prohibited</span>
 <span class="err">*</span> <span class="err">Proprietary</span> <span class="err">and</span> <span class="err">confidential</span>
 <span class="err">*/</span>

<span class="err">package</span> <span class="err">eu.brain.iot.eventing.api;</span>

<span class="err">import</span> <span class="err">java.time.Instant;</span>

<span class="err">import</span> <span class="err">org.osgi.annotation.versioning.ConsumerType;</span>
<span class="err">import</span> <span class="err">org.osgi.dto.DTO;</span>

<span class="err">/**</span>
 <span class="err">*</span> <span class="err">An</span> <span class="err">common</span> <span class="err">super-type</span> <span class="err">for</span> <span class="err">all</span> <span class="err">Brain</span> <span class="err">IoT</span> <span class="err">events</span> <span class="err">containing</span> 
 <span class="err">*</span> <span class="err">information</span> <span class="err">that</span> <span class="err">must</span> <span class="err">exist</span> <span class="err">for</span> <span class="err">all</span> <span class="err">events.</span>
 <span class="err">*/</span>
<span class="err">@ConsumerType</span>
<span class="err">public</span> <span class="err">abstract</span> <span class="err">class</span> <span class="err">BrainIoTEvent</span> <span class="err">extends</span> <span class="err">DTO</span> <span class="err">{</span>

	<span class="err">/**</span>
	 <span class="err">*</span> <span class="err">The</span> <span class="err">identifier</span> <span class="err">of</span> <span class="err">the</span> <span class="err">node</span> <span class="err">creating</span> <span class="err">the</span> <span class="err">event</span> <span class="err">  </span>
	 <span class="err">*/</span>
    <span class="err">public</span> <span class="err">String</span> <span class="err">sourceNode;</span>
 
    <span class="err">/**</span> <span class="err">  </span>
<span class="err">   </span>  <span class="err">*</span> <span class="err">The</span> <span class="err">time</span> <span class="err">at</span> <span class="err">which</span> <span class="err">this</span> <span class="err">event</span> <span class="err">was</span> <span class="err">created</span> <span class="err"> </span>
<span class="err">   </span>  <span class="err">*/</span>
    <span class="err">public</span> <span class="err">Instant</span> <span class="err">timestamp;</span>
 
    <span class="err">/**</span> <span class="err">  </span>
<span class="err">    </span> <span class="err">*</span> <span class="err">The</span> <span class="err">security</span> <span class="err">token</span> <span class="err">that</span> <span class="err">can</span> <span class="err">be</span> <span class="err">used</span> <span class="err">to</span> <span class="err">authenticate/validate</span> <span class="err">the</span> <span class="err">event</span> <span class="err">  </span>
<span class="err">    </span> <span class="err">*/</span>
    <span class="err">public</span> <span class="err">byte[]</span> <span class="err">securityToken;</span>
<span class="err">}</span></code></pre></figure>

  </div>
</div>

<h4 id="dependencies">Dependencies</h4>

<p>Open pom.xml of <code class="language-plaintext highlighter-rouge">light.api</code> and add following dependency of the BRAIN-IoT Events and EventBus:</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>com.paremus.brain.iot<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>eventing.api<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;version&gt;</span>0.0.1-SNAPSHOT<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</code></pre></div></div>
<p>which provides the <code class="language-plaintext highlighter-rouge">BrainIoTEvent</code>, <code class="language-plaintext highlighter-rouge">EventBus</code>, <code class="language-plaintext highlighter-rouge">SmartBehaviour</code> and <code class="language-plaintext highlighter-rouge">UntypedSmartBehaviour</code> interfaces and others.</p>

<p class="note">Note that a Smart Behaviour must consume typed events and cannot be used to consume unknown event types. If unknown event types are to be consumed then an <code class="language-plaintext highlighter-rouge">UntypedSmartBehaviour</code> must be used.</p>

<h4 id="visibility">Visibility</h4>
<p><code class="language-plaintext highlighter-rouge">light.api</code> is an API package which is imported by other implementation modules, hence it must must be exported. This is indicated by the automatically generated file <code class="language-plaintext highlighter-rouge">~/eventing-example/light.api/src/main/java/com/paremus/brain/iot/example/light/api/package-info.java</code>:</p>
<p>
  <a class="btn btn-primary" data-toggle="collapse" href="#package-info" aria-expanded="false" aria-controls="package-info.java">package-info.java</a>
</p>

<div class="collapse" id="package-info">
  <div class="card card-block">

<figure class="highlight"><pre><code class="language-properties" data-lang="properties"><span class="err">@org.osgi.annotation.bundle.Export</span>
<span class="err">@org.osgi.annotation.versioning.Version("1.0.0")</span>
<span class="err">package</span> <span class="err">com.paremus.brain.iot.example.light.api;</span></code></pre></figure>

  </div>
</div>

<h4 id="defining-the-brain-iot-events">Defining the BRAIN-IoT Events</h4>
<p>The customized events should be defined as following:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">XXX</span> <span class="kd">extends</span> <span class="nc">BrainIoTEvent</span> <span class="o">{</span>
    <span class="c1">// TODO: add other fields if need</span>
<span class="o">}</span>
</code></pre></div></div>
<p>Remove original auto-generated java classes in src package:</p>

<p><code class="language-plaintext highlighter-rouge">~/eventing-example/light.api/src/main/java/com/paremus/brain/iot/example/light/api/ProviderInterface.java</code></p>

<p><code class="language-plaintext highlighter-rouge">~/eventing-example/light.api/src/main/java/com/paremus/brain/iot/example/light/api/ConsumerInterface.java</code></p>

<p>and create the following four files:</p>

<p><code class="language-plaintext highlighter-rouge">~/eventing-example/light.api/src/main/java/com/paremus/brain/iot/example/light/api/AbstractLightDTO.java</code></p>

<p><code class="language-plaintext highlighter-rouge">~/eventing-example/light.api/src/main/java/com/paremus/brain/iot/example/light/api/LightCommand.java</code></p>

<p><code class="language-plaintext highlighter-rouge">~/eventing-example/light.api/src/main/java/com/paremus/brain/iot/example/light/api/LightQuery.java</code></p>

<p><code class="language-plaintext highlighter-rouge">~/eventing-example/light.api/src/main/java/com/paremus/brain/iot/example/light/api/LightQueryResponse.java</code></p>

<p>
  <a class="btn btn-primary" data-toggle="collapse" href="#AbstractLightDTO" aria-expanded="false" aria-controls="AbstractLightDTO.java">AbstractLightDTO.java</a>
  <a class="btn btn-primary" data-toggle="collapse" href="#LightCommand" aria-expanded="false" aria-controls="LightCommand.java">LightCommand.java</a>
  <a class="btn btn-primary" data-toggle="collapse" href="#LightQuery" aria-expanded="false" aria-controls="LightQuery.java">LightQuery.java</a>
  <a class="btn btn-primary" data-toggle="collapse" href="#LightQueryResponse" aria-expanded="false" aria-controls="LightQueryResponse.java">LightQueryResponse.java</a>
</p>

<div class="collapse" id="AbstractLightDTO">
  <div class="card card-block">

<figure class="highlight"><pre><code class="language-properties" data-lang="properties"><span class="err">/*</span> <span class="err">Copyright</span> <span class="err">2019</span> <span class="err">Paremus,</span> <span class="err">Ltd</span> <span class="err">-</span> <span class="err">All</span> <span class="err">Rights</span> <span class="err">Reserved</span>
 <span class="err">*</span> <span class="err">Unauthorized</span> <span class="err">copying</span> <span class="err">of</span> <span class="err">this</span> <span class="err">file,</span> <span class="err">via</span> <span class="err">any</span> <span class="err">medium</span> <span class="err">is</span> <span class="err">strictly</span> <span class="err">prohibited</span>
 <span class="err">*</span> <span class="err">Proprietary</span> <span class="err">and</span> <span class="err">confidential</span>
 <span class="err">*/</span>
<span class="err">package</span> <span class="err">com.paremus.brain.iot.example.light.api;</span>

<span class="err">import</span> <span class="err">eu.brain.iot.eventing.api.BrainIoTEvent;</span>

<span class="err">public</span> <span class="err">abstract</span> <span class="err">class</span> <span class="err">AbstractLightDTO</span> <span class="err">extends</span> <span class="err">BrainIoTEvent</span> <span class="err">{</span>
	
	<span class="err">public</span> <span class="err">boolean</span> <span class="err">status;</span>
	
	<span class="err">public</span> <span class="err">int</span> <span class="err">brightness;</span>

<span class="err">}</span></code></pre></figure>

  </div>
</div>

<div class="collapse" id="LightCommand">
  <div class="card card-block">

<figure class="highlight"><pre><code class="language-properties" data-lang="properties"><span class="err">/*</span> <span class="err">Copyright</span> <span class="err">2019</span> <span class="err">Paremus,</span> <span class="err">Ltd</span> <span class="err">-</span> <span class="err">All</span> <span class="err">Rights</span> <span class="err">Reserved</span>
 <span class="err">*</span> <span class="err">Unauthorized</span> <span class="err">copying</span> <span class="err">of</span> <span class="err">this</span> <span class="err">file,</span> <span class="err">via</span> <span class="err">any</span> <span class="err">medium</span> <span class="err">is</span> <span class="err">strictly</span> <span class="err">prohibited</span>
 <span class="err">*</span> <span class="err">Proprietary</span> <span class="err">and</span> <span class="err">confidential</span>
 <span class="err">*/</span>
<span class="err">package</span> <span class="err">com.paremus.brain.iot.example.light.api;</span>

<span class="err">public</span> <span class="err">class</span> <span class="err">LightCommand</span> <span class="err">extends</span> <span class="err">AbstractLightDTO</span> <span class="err">{</span>

<span class="err">}</span></code></pre></figure>

  </div>
</div>

<div class="collapse" id="LightQuery">
  <div class="card card-block">

<figure class="highlight"><pre><code class="language-properties" data-lang="properties"><span class="err">/*</span> <span class="err">Copyright</span> <span class="err">2019</span> <span class="err">Paremus,</span> <span class="err">Ltd</span> <span class="err">-</span> <span class="err">All</span> <span class="err">Rights</span> <span class="err">Reserved</span>
 <span class="err">*</span> <span class="err">Unauthorized</span> <span class="err">copying</span> <span class="err">of</span> <span class="err">this</span> <span class="err">file,</span> <span class="err">via</span> <span class="err">any</span> <span class="err">medium</span> <span class="err">is</span> <span class="err">strictly</span> <span class="err">prohibited</span>
 <span class="err">*</span> <span class="err">Proprietary</span> <span class="err">and</span> <span class="err">confidential</span>
 <span class="err">*/</span>
<span class="err">package</span> <span class="err">com.paremus.brain.iot.example.light.api;</span>

<span class="err">import</span> <span class="err">eu.brain.iot.eventing.api.BrainIoTEvent;</span>

<span class="err">public</span> <span class="err">class</span> <span class="err">LightQuery</span> <span class="err">extends</span> <span class="err">BrainIoTEvent</span> <span class="err">{</span>

<span class="err">}</span></code></pre></figure>

  </div>
</div>

<div class="collapse" id="LightQueryResponse">
  <div class="card card-block">

<figure class="highlight"><pre><code class="language-properties" data-lang="properties"><span class="err">/*</span> <span class="err">Copyright</span> <span class="err">2019</span> <span class="err">Paremus,</span> <span class="err">Ltd</span> <span class="err">-</span> <span class="err">All</span> <span class="err">Rights</span> <span class="err">Reserved</span>
 <span class="err">*</span> <span class="err">Unauthorized</span> <span class="err">copying</span> <span class="err">of</span> <span class="err">this</span> <span class="err">file,</span> <span class="err">via</span> <span class="err">any</span> <span class="err">medium</span> <span class="err">is</span> <span class="err">strictly</span> <span class="err">prohibited</span>
 <span class="err">*</span> <span class="err">Proprietary</span> <span class="err">and</span> <span class="err">confidential</span>
 <span class="err">*/</span>
<span class="err">package</span> <span class="err">com.paremus.brain.iot.example.light.api;</span>

<span class="err">public</span> <span class="err">class</span> <span class="err">LightQueryResponse</span> <span class="err">extends</span> <span class="err">AbstractLightDTO</span> <span class="err">{</span>
	
	<span class="err">public</span> <span class="err">String</span> <span class="err">requestor;</span>

<span class="err">}</span></code></pre></figure>

  </div>
</div>

<p class="note">Alternatly, you can copy all source java files from the <code class="language-plaintext highlighter-rouge">light.api</code> sub-project of downloaded <a href="https://git.repository-pert.ismb.it/BRAIN-IoT/SmartBehaviourEventBus.git" target="_blank">SmartBehaviourEventBus</a> Git repository to the src package.</p>

<h3 id="create-light-smart-behaviour-implementation-module">Create Light Smart Behaviour Implementation Module</h3>

<p>A Smart Behavior is implemented as Declarative Service using the <code class="language-plaintext highlighter-rouge">@SmartBehaviourDefinition</code> annotation provided by above <code class="language-plaintext highlighter-rouge">eventing.api</code> dependency, and its relevant Capabilities (specified by the types of the consumed BRAIN-IoT events) are configured through the properties of the annotation.</p>

<p>Now, in the <code class="language-plaintext highlighter-rouge">eventing-example</code> project directory, create the <code class="language-plaintext highlighter-rouge">light.impl</code> module using the <a href="https://enroute.osgi.org/about/112-enRoute-Archetypes.html#the-rest-component-archetype" target="_blank">rest-component Archetype</a>:</p>

<div class="language-plaintext shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>~/eventing-example $ mvn archetype:generate \
     -DarchetypeGroupId=org.osgi.enroute.archetype \
     -DarchetypeArtifactId=rest-component \
     -DarchetypeVersion=7.0.0
</code></pre></div></div>
<p>with the following values:</p>

<div class="language-plaintext shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Define value for property 'groupId': com.paremus.brain.iot.example
Define value for property 'artifactId': light.impl
Define value for property 'version' 1.0-SNAPSHOT: : 0.0.1-SNAPSHOT
Define value for property 'package' com.paremus.brain.iot.example.light.impl: : 
Confirm properties configuration:
groupId: com.paremus.brain.iot.example
artifactId: light.impl
version: 0.0.1-SNAPSHOT
package: com.paremus.brain.iot.example.light.impl
 Y: :
</code></pre></div></div>
<h4 id="dependencies-1">Dependencies</h4>
<p>Append the following dependencies in the <code class="language-plaintext highlighter-rouge">&lt;dependencies&gt;</code> section of POM:</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="nt">&lt;dependencies&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>com.paremus.brain.iot<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>eventing.api<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>com.paremus.brain.iot.example<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>light.api<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;version&gt;</span>0.0.1-SNAPSHOT<span class="nt">&lt;/version&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.osgi.enroute<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>impl-index<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;type&gt;</span>pom<span class="nt">&lt;/type&gt;</span>
            <span class="nt">&lt;scope&gt;</span>runtime<span class="nt">&lt;/scope&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.apache.aries.jax.rs<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>org.apache.aries.jax.rs.jackson<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>com.paremus.brain.iot<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>eventing.impl<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>com.paremus.brain.iot<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>message.integrity.insecure.impl<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
     <span class="nt">&lt;/dependencies&gt;</span>
</code></pre></div></div>

<p>
  <a class="btn btn-primary" data-toggle="collapse" href="#lightImpl-pom" aria-expanded="false" aria-controls="lightImpl-pom">pom.xml</a>
</p>

<div class="collapse" id="lightImpl-pom">
  <div class="card card-block">

<figure class="highlight"><pre><code class="language-properties" data-lang="properties"><span class="err">&lt;?xml</span> <span class="py">version</span><span class="p">=</span><span class="s">"1.0"</span> <span class="s">encoding="UTF-8"?&gt;</span>
<span class="err">&lt;project</span> <span class="py">xmlns</span><span class="p">=</span><span class="s">"http://maven.apache.org/POM/4.0.0"</span> <span class="s">xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"&gt;</span>
    <span class="err">&lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;</span>
    <span class="err">&lt;parent&gt;</span>
    <span class="err">&lt;artifactId&gt;eventing-example&lt;/artifactId&gt;</span>
    <span class="err">&lt;groupId&gt;com.paremus.brain.iot.example&lt;/groupId&gt;</span>
    <span class="err">&lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt;</span>
  <span class="err">&lt;/parent&gt;</span>

    <span class="err">&lt;groupId&gt;com.paremus.brain.iot.example&lt;/groupId&gt;</span>
    <span class="err">&lt;artifactId&gt;light.impl&lt;/artifactId&gt;</span>
    <span class="err">&lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt;</span>

    <span class="err">&lt;description&gt;The</span> <span class="err">light.impl</span> <span class="err">DS</span> <span class="err">component</span> <span class="err">-</span> <span class="err">built</span> <span class="err">using</span> <span class="err">OSGi</span> <span class="err">enRoute</span> <span class="err">R7&lt;/description&gt;</span>

    <span class="err">&lt;dependencies&gt;</span>
        <span class="err">&lt;dependency&gt;</span>
            <span class="err">&lt;groupId&gt;org.osgi.enroute&lt;/groupId&gt;</span>
            <span class="err">&lt;artifactId&gt;osgi-api&lt;/artifactId&gt;</span>
            <span class="err">&lt;type&gt;pom&lt;/type&gt;</span>
        <span class="err">&lt;/dependency&gt;</span>
        <span class="err">&lt;dependency&gt;</span>
            <span class="err">&lt;groupId&gt;org.osgi.enroute&lt;/groupId&gt;</span>
            <span class="err">&lt;artifactId&gt;enterprise-api&lt;/artifactId&gt;</span>
            <span class="err">&lt;type&gt;pom&lt;/type&gt;</span>
        <span class="err">&lt;/dependency&gt;</span>
        <span class="err">&lt;dependency&gt;</span>
            <span class="err">&lt;groupId&gt;org.osgi.enroute&lt;/groupId&gt;</span>
            <span class="err">&lt;artifactId&gt;test-bundles&lt;/artifactId&gt;</span>
            <span class="err">&lt;type&gt;pom&lt;/type&gt;</span>
        <span class="err">&lt;/dependency&gt;</span>
        <span class="err">&lt;dependency&gt;</span>
            <span class="err">&lt;groupId&gt;com.paremus.brain.iot&lt;/groupId&gt;</span>
            <span class="err">&lt;artifactId&gt;eventing.api&lt;/artifactId&gt;</span>
        <span class="err">&lt;/dependency&gt;</span>
        <span class="err">&lt;dependency&gt;</span>
            <span class="err">&lt;groupId&gt;com.paremus.brain.iot.example&lt;/groupId&gt;</span>
            <span class="err">&lt;artifactId&gt;light.api&lt;/artifactId&gt;</span>
            <span class="err">&lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt;</span>
        <span class="err">&lt;/dependency&gt;</span>
        <span class="err">&lt;dependency&gt;</span>
            <span class="err">&lt;groupId&gt;org.osgi.enroute&lt;/groupId&gt;</span>
            <span class="err">&lt;artifactId&gt;impl-index&lt;/artifactId&gt;</span>
            <span class="err">&lt;type&gt;pom&lt;/type&gt;</span>
            <span class="err">&lt;scope&gt;runtime&lt;/scope&gt;</span>
        <span class="err">&lt;/dependency&gt;</span>
        <span class="err">&lt;dependency&gt;</span>
            <span class="err">&lt;groupId&gt;org.apache.aries.jax.rs&lt;/groupId&gt;</span>
            <span class="err">&lt;artifactId&gt;org.apache.aries.jax.rs.jackson&lt;/artifactId&gt;</span>
        <span class="err">&lt;/dependency&gt;</span>
        <span class="err">&lt;dependency&gt;</span>
            <span class="err">&lt;groupId&gt;com.paremus.brain.iot&lt;/groupId&gt;</span>
            <span class="err">&lt;artifactId&gt;eventing.impl&lt;/artifactId&gt;</span>
        <span class="err">&lt;/dependency&gt;</span>
        <span class="err">&lt;dependency&gt;</span>
            <span class="err">&lt;groupId&gt;com.paremus.brain.iot&lt;/groupId&gt;</span>
            <span class="err">&lt;artifactId&gt;message.integrity.insecure.impl&lt;/artifactId&gt;</span>
        <span class="err">&lt;/dependency&gt;</span>

     <span class="err">&lt;/dependencies&gt;</span>


    <span class="err">&lt;build&gt;</span>
        <span class="err">&lt;plugins&gt;</span>
           <span class="err">&lt;</span><span class="c">!-- Expected to inherit configuration from a parent enRoute 
</span>                <span class="err">pom.</span> <span class="err">This</span> <span class="err">includes</span> <span class="err">-contract</span> <span class="err">definitions</span> <span class="err">and</span> <span class="err">maven-jar-plugin</span> <span class="err">setup</span> <span class="err">--&gt;</span>
            <span class="err">&lt;plugin&gt;</span>
                <span class="err">&lt;groupId&gt;biz.aQute.bnd&lt;/groupId&gt;</span>
                <span class="err">&lt;artifactId&gt;bnd-maven-plugin&lt;/artifactId&gt;</span>
            <span class="err">&lt;/plugin&gt;</span>
            <span class="err">&lt;plugin&gt;</span>
                <span class="err">&lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;</span>
                <span class="err">&lt;artifactId&gt;maven-jar-plugin&lt;/artifactId&gt;</span>
            <span class="err">&lt;/plugin&gt;</span>
            <span class="err">&lt;</span><span class="c">!-- Validate that the smart behaviour can resolve --&gt;
</span>            <span class="err">&lt;plugin&gt;</span>
                <span class="err">&lt;groupId&gt;biz.aQute.bnd&lt;/groupId&gt;</span>
                <span class="err">&lt;artifactId&gt;bnd-resolver-maven-plugin&lt;/artifactId&gt;</span>
                <span class="err">&lt;executions&gt;</span>
                    <span class="err">&lt;execution&gt;</span>
                        <span class="err">&lt;goals&gt;</span>
                            <span class="err">&lt;goal&gt;resolve&lt;/goal&gt;</span>
                        <span class="err">&lt;/goals&gt;</span>
                        <span class="err">&lt;phase&gt;package&lt;/phase&gt;</span>
                        <span class="err">&lt;configuration&gt;</span>
                            <span class="err">&lt;bndruns&gt;</span>
                                <span class="err">&lt;bndrun&gt;light.bndrun&lt;/bndrun&gt;</span>
                            <span class="err">&lt;/bndruns&gt;</span>
                        <span class="err">&lt;/configuration&gt;</span>
                    <span class="err">&lt;/execution&gt;</span>
                <span class="err">&lt;/executions&gt;</span>
            <span class="err">&lt;/plugin&gt;</span>
             <span class="err">&lt;plugin&gt;</span>
                <span class="err">&lt;groupId&gt;com.paremus.brain.iot.maven&lt;/groupId&gt;</span>
                <span class="err">&lt;artifactId&gt;smart-behaviour-maven-plugin&lt;/artifactId&gt;</span>
                <span class="err">&lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt;</span>
                <span class="err">&lt;executions&gt;</span>
					<span class="err">&lt;execution&gt;</span>
						<span class="err">&lt;goals&gt;</span>
							<span class="err">&lt;goal&gt;smart-behaviour&lt;/goal&gt;</span>
						<span class="err">&lt;/goals&gt;</span>
						<span class="err">&lt;configuration&gt;</span>
						    <span class="err">&lt;bndrun&gt;light.bndrun&lt;/bndrun&gt;</span>
						<span class="err">&lt;/configuration&gt;</span>
					<span class="err">&lt;/execution&gt;</span>
				<span class="err">&lt;/executions&gt;</span>
            <span class="err">&lt;/plugin&gt;</span>
        <span class="err">&lt;/plugins&gt;</span>
    <span class="err">&lt;/build&gt;</span>

<span class="err">&lt;/project&gt;</span></code></pre></figure>

  </div>
</div>

<h4 id="implement-the-light-smart-behaviour">Implement the <code class="language-plaintext highlighter-rouge">light</code> smart behaviour</h4>
<p>Remove original auto-generated java classes in src package:</p>

<p><code class="language-plaintext highlighter-rouge">~/eventing-example/light.impl/src/main/java/com/paremus/brain/iot/example/light/impl/RestComponentImpl.java</code></p>

<p>And create the following two files:</p>

<p><code class="language-plaintext highlighter-rouge">~/eventing-example/light.impl/src/main/java/com/paremus/brain/iot/example/light/impl/LightDTO.java</code></p>

<p><code class="language-plaintext highlighter-rouge">~/eventing-example/light.impl/src/main/java/com/paremus/brain/iot/example/light/impl/RestComponentImpl.java</code></p>

<p>
  <a class="btn btn-primary" data-toggle="collapse" href="#LightDTO" aria-expanded="false" aria-controls="LightDTO.java">LightDTO.java</a>
  <a class="btn btn-primary" data-toggle="collapse" href="#RestComponentImpl" aria-expanded="false" aria-controls="RestComponentImpl.java">RestComponentImpl.java</a>
</p>

<div class="collapse" id="LightDTO">
  <div class="card card-block">

<figure class="highlight"><pre><code class="language-properties" data-lang="properties"><span class="err">/*</span> <span class="err">Copyright</span> <span class="err">2019</span> <span class="err">Paremus,</span> <span class="err">Ltd</span> <span class="err">-</span> <span class="err">All</span> <span class="err">Rights</span> <span class="err">Reserved</span>
 <span class="err">*</span> <span class="err">Unauthorized</span> <span class="err">copying</span> <span class="err">of</span> <span class="err">this</span> <span class="err">file,</span> <span class="err">via</span> <span class="err">any</span> <span class="err">medium</span> <span class="err">is</span> <span class="err">strictly</span> <span class="err">prohibited</span>
 <span class="err">*</span> <span class="err">Proprietary</span> <span class="err">and</span> <span class="err">confidential</span>
 <span class="err">*/</span>
<span class="err">package</span> <span class="err">com.paremus.brain.iot.example.light.impl;</span>

<span class="err">public</span> <span class="err">class</span> <span class="err">LightDTO</span> <span class="err">{</span>
	
	<span class="err">public</span> <span class="err">boolean</span> <span class="err">status;</span>
	
	<span class="err">public</span> <span class="err">int</span> <span class="err">brightness;</span>

<span class="err">}</span></code></pre></figure>

  </div>
</div>

<div class="collapse" id="RestComponentImpl">
  <div class="card card-block">

<figure class="highlight"><pre><code class="language-properties" data-lang="properties"><span class="err">/*</span> <span class="err">Copyright</span> <span class="err">2019</span> <span class="err">Paremus,</span> <span class="err">Ltd</span> <span class="err">-</span> <span class="err">All</span> <span class="err">Rights</span> <span class="err">Reserved</span>
 <span class="err">*</span> <span class="err">Unauthorized</span> <span class="err">copying</span> <span class="err">of</span> <span class="err">this</span> <span class="err">file,</span> <span class="err">via</span> <span class="err">any</span> <span class="err">medium</span> <span class="err">is</span> <span class="err">strictly</span> <span class="err">prohibited</span>
 <span class="err">*</span> <span class="err">Proprietary</span> <span class="err">and</span> <span class="err">confidential</span>
 <span class="err">*/</span>
<span class="err">package</span> <span class="err">com.paremus.brain.iot.example.light.impl;</span>

<span class="err">import</span> <span class="err">com.paremus.brain.iot.example.light.api.LightCommand;</span>
<span class="err">import</span> <span class="err">com.paremus.brain.iot.example.light.api.LightQuery;</span>
<span class="err">import</span> <span class="err">com.paremus.brain.iot.example.light.api.LightQueryResponse;</span>
<span class="err">import</span> <span class="err">eu.brain.iot.eventing.annotation.SmartBehaviourDefinition;</span>
<span class="err">import</span> <span class="err">eu.brain.iot.eventing.api.BrainIoTEvent;</span>
<span class="err">import</span> <span class="err">eu.brain.iot.eventing.api.EventBus;</span>
<span class="err">import</span> <span class="err">eu.brain.iot.eventing.api.SmartBehaviour;</span>
<span class="err">import</span> <span class="err">org.osgi.service.component.annotations.Component;</span>
<span class="err">import</span> <span class="err">org.osgi.service.component.annotations.Reference;</span>
<span class="err">import</span> <span class="err">org.osgi.service.http.whiteboard.propertytypes.HttpWhiteboardResource;</span>
<span class="err">import</span> <span class="err">org.osgi.service.jaxrs.whiteboard.propertytypes.JSONRequired;</span>
<span class="err">import</span> <span class="err">org.osgi.service.jaxrs.whiteboard.propertytypes.JaxrsResource;</span>

<span class="err">import</span> <span class="err">javax.ws.rs.GET;</span>
<span class="err">import</span> <span class="err">javax.ws.rs.Path;</span>
<span class="err">import</span> <span class="err">javax.ws.rs.Produces;</span>
<span class="err">import</span> <span class="err">javax.ws.rs.core.Context;</span>
<span class="err">import</span> <span class="err">javax.ws.rs.ext.MessageBodyWriter;</span>
<span class="err">import</span> <span class="err">javax.ws.rs.ext.Providers;</span>
<span class="err">import</span> <span class="err">javax.ws.rs.sse.Sse;</span>
<span class="err">import</span> <span class="err">javax.ws.rs.sse.SseBroadcaster;</span>
<span class="err">import</span> <span class="err">javax.ws.rs.sse.SseEventSink;</span>
<span class="err">import</span> <span class="err">java.io.ByteArrayOutputStream;</span>
<span class="err">import</span> <span class="err">java.io.IOException;</span>

<span class="err">import</span> <span class="err">static</span> <span class="err">javax.ws.rs.core.MediaType.APPLICATION_JSON;</span>
<span class="err">import</span> <span class="err">static</span> <span class="err">javax.ws.rs.core.MediaType.APPLICATION_JSON_TYPE;</span>

<span class="err">/**</span>
 <span class="err">*</span> <span class="err">This</span> <span class="err">component</span> <span class="err">represents</span> <span class="err">two</span> <span class="py">things</span><span class="p">:</span>
 <span class="err">*</span>
 <span class="err">*</span>  <span class="err">1.</span> <span class="err">A</span> <span class="err">Smart</span> <span class="err">Light</span> <span class="err">Bulb</span> <span class="err">controlled</span> <span class="err">using</span> <span class="err">events</span>
 <span class="err">*</span>  <span class="err">2.</span> <span class="err">A</span> <span class="err">set</span> <span class="err">of</span> <span class="err">REST</span> <span class="err">resources</span> <span class="err">used</span> <span class="err">by</span> <span class="err">a</span> <span class="err">web</span> <span class="err">ui</span> <span class="err">to</span> <span class="err">display</span> <span class="err">the</span> <span class="err">light</span> <span class="err">bulb</span>
 <span class="err">*</span>
 <span class="err">*/</span>
<span class="err">@Component(</span><span class="py">service</span><span class="p">=</span> <span class="s">{SmartBehaviour.class, RestComponentImpl.class})</span>
<span class="err">@JaxrsResource</span>
<span class="err">@HttpWhiteboardResource(</span><span class="py">pattern</span><span class="p">=</span><span class="s">"/light-ui/*", prefix="/static")</span>
<span class="err">@JSONRequired</span>
<span class="err">@SmartBehaviourDefinition(</span><span class="py">consumed</span> <span class="p">=</span> <span class="s">{LightCommand.class, LightQuery.class}, filter = "(brightness=*)",</span>
        <span class="py">author</span> <span class="p">=</span> <span class="s">"Paremus", name = "Example Smart Light Bulb",</span>
        <span class="py">description</span> <span class="p">=</span> <span class="s">"Implements a Smart Light Bulb and UI to display it.")</span>
<span class="err">public</span> <span class="err">class</span> <span class="err">RestComponentImpl</span> <span class="err">implements</span> <span class="err">SmartBehaviour&lt;BrainIoTEvent&gt;{</span>

	<span class="err">/*</span>
	 <span class="err">*</span> <span class="err">A</span> <span class="err">Smart</span> <span class="err">Behaviour</span> <span class="err">representing</span> <span class="err">a</span> <span class="err">lightbulb</span>
	 <span class="err">*/</span>

	<span class="err">@Reference</span>
	<span class="err">private</span> <span class="err">EventBus</span> <span class="err">eventBus;</span>

	<span class="err">private</span> <span class="err">boolean</span> <span class="err">status;</span>

	<span class="err">private</span> <span class="err">int</span> <span class="err">brightness;</span>

	<span class="err">@Override</span>
	<span class="err">public</span> <span class="err">void</span> <span class="err">notify(BrainIoTEvent</span> <span class="err">event)</span> <span class="err">{</span>
		<span class="err">if(event</span> <span class="err">instanceof</span> <span class="err">LightQuery)</span> <span class="err">{</span>
			<span class="err">LightQueryResponse</span> <span class="py">response</span> <span class="p">=</span> <span class="s">new LightQueryResponse();</span>
			<span class="py">response.requestor</span> <span class="p">=</span> <span class="s">event.sourceNode;</span>
			<span class="err">synchronized</span> <span class="err">(this)</span> <span class="err">{</span>
				<span class="py">response.brightness</span> <span class="p">=</span> <span class="s">brightness;</span>
				<span class="py">response.status</span> <span class="p">=</span> <span class="s">status;</span>
			<span class="err">}</span>
			<span class="err">eventBus.deliver(response);</span>
		<span class="err">}</span> <span class="err">else</span> <span class="err">if</span> <span class="err">(event</span> <span class="err">instanceof</span> <span class="err">LightCommand)</span> <span class="err">{</span>
			<span class="err">LightCommand</span> <span class="py">command</span> <span class="p">=</span> <span class="s">(LightCommand) event;</span>
			<span class="err">LightDTO</span> <span class="py">dto</span> <span class="p">=</span> <span class="s">new LightDTO();</span>
			<span class="err">synchronized</span> <span class="err">(this)</span> <span class="err">{</span>
				<span class="py">status</span> <span class="p">=</span> <span class="s">command.status;</span>
				<span class="py">brightness</span> <span class="p">=</span> <span class="s">command.brightness;</span>

				<span class="py">dto.status</span> <span class="p">=</span> <span class="s">status;</span>
				<span class="py">dto.brightness</span> <span class="p">=</span> <span class="s">brightness;</span>
			<span class="err">}</span>
			<span class="err">brightnessChanged(dto);</span>
		<span class="err">}</span> <span class="err">else</span> <span class="err">{</span>
			<span class="err">System.out.println("Argh</span><span class="c">! Received an unknown event type " + event.getClass());
</span>		<span class="err">}</span>

	<span class="err">}</span>

	<span class="err">/*</span>
	 <span class="err">*</span>
	 <span class="err">*</span> <span class="err">JAX-RS</span> <span class="err">logic</span> <span class="err">for</span> <span class="err">the</span> <span class="err">lightbulb</span> <span class="err">UI</span>
	 <span class="err">*</span>
	 <span class="err">*/</span>

	<span class="err">private</span> <span class="err">SseBroadcaster</span> <span class="err">broadcaster;</span>
	<span class="err">private</span> <span class="err">Sse</span> <span class="err">sse;</span>
	<span class="err">private</span> <span class="err">Providers</span> <span class="err">providers;</span>

	<span class="err">private</span> <span class="err">void</span> <span class="err">brightnessChanged(LightDTO</span> <span class="err">brightness)</span> <span class="err">{</span>
		<span class="err">SseBroadcaster</span> <span class="err">broadcasterToUse;</span>
		<span class="err">Sse</span> <span class="err">sseToUse;</span>
		<span class="err">Providers</span> <span class="err">providersToUse;</span>
    	<span class="err">synchronized</span> <span class="err">(this)</span> <span class="err">{</span>
			<span class="py">sseToUse</span> <span class="p">=</span> <span class="s">sse;</span>
			<span class="py">broadcasterToUse</span> <span class="p">=</span> <span class="s">broadcaster;</span>
			<span class="py">providersToUse</span> <span class="p">=</span> <span class="s">providers;</span>
		<span class="err">}</span>

    	<span class="err">if(broadcasterToUse</span> <span class="c">!= null) {
</span>    		<span class="err">try(ByteArrayOutputStream</span> <span class="py">baos</span> <span class="p">=</span> <span class="s">new ByteArrayOutputStream()) {</span>
				<span class="err">MessageBodyWriter&lt;LightDTO&gt;</span> <span class="py">writer</span> <span class="p">=</span> <span class="s">providersToUse.getMessageBodyWriter(LightDTO.class, null, null, APPLICATION_JSON_TYPE);</span>
    			<span class="err">writer.writeTo(brightness,</span> <span class="err">LightDTO.class,</span> <span class="err">null,</span> <span class="err">null,</span> <span class="err">APPLICATION_JSON_TYPE,</span> <span class="err">null,</span> <span class="err">baos);</span>
    			<span class="err">broadcasterToUse.broadcast(sseToUse.newEvent(baos.toString()));</span>
    		<span class="err">}</span> <span class="err">catch</span> <span class="err">(IOException</span> <span class="err">e)</span> <span class="err">{</span>
				<span class="err">broadcaster.broadcast(sseToUse.newEvent("error",</span> <span class="err">e.getMessage()));</span>
			<span class="err">}</span>

    	<span class="err">}</span>
	<span class="err">}</span>

	<span class="err">@Path("light")</span>
	<span class="err">@GET</span>
	<span class="err">@Produces(APPLICATION_JSON)</span>
	<span class="err">public</span> <span class="err">LightDTO</span> <span class="err">light()</span> <span class="err">{</span>
		<span class="err">LightDTO</span> <span class="py">dto</span> <span class="p">=</span> <span class="s">new LightDTO();</span>

		<span class="err">synchronized</span> <span class="err">(this)</span> <span class="err">{</span>
			<span class="py">dto.status</span> <span class="p">=</span> <span class="s">status;</span>
			<span class="py">dto.brightness</span> <span class="p">=</span> <span class="s">brightness;</span>
		<span class="err">}</span>

		<span class="err">return</span> <span class="err">dto;</span>
	<span class="err">}</span>

	<span class="err">@Path("light/stream")</span>
	<span class="err">@GET</span>
	<span class="err">@Produces("text/event-stream")</span>
	<span class="err">public</span> <span class="err">void</span> <span class="err">getLiveUpdates(@Context</span> <span class="err">SseEventSink</span> <span class="err">eventSink,</span> <span class="err">@Context</span> <span class="err">Sse</span> <span class="err">sse,</span> <span class="err">@Context</span> <span class="err">Providers</span> <span class="err">providers)</span> <span class="err">{</span>

		<span class="err">SseBroadcaster</span> <span class="err">toUse;</span>
		<span class="err">synchronized</span> <span class="err">(this)</span> <span class="err">{</span>
			<span class="err">if</span> <span class="err">(</span><span class="py">this.sse</span> <span class="p">=</span><span class="s">= null) {</span>
				<span class="py">this.sse</span> <span class="p">=</span> <span class="s">sse;</span>
				<span class="py">broadcaster</span> <span class="p">=</span> <span class="s">sse.newBroadcaster();</span>
				<span class="py">this.providers</span> <span class="p">=</span> <span class="s">providers;</span>
			<span class="err">}</span>
			<span class="py">toUse</span> <span class="p">=</span> <span class="s">broadcaster;</span>
		<span class="err">}</span>

		<span class="err">toUse.register(eventSink);</span>

		<span class="err">brightnessChanged(light());</span>
	<span class="err">}</span>
<span class="err">}</span></code></pre></figure>

  </div>
</div>

<p class="note">You can copy the <code class="language-plaintext highlighter-rouge">RestComponentImpl.java</code>, <code class="language-plaintext highlighter-rouge">LightDTO.java</code> source files from the <code class="language-plaintext highlighter-rouge">light.impl</code> sub-project of downloaded <a href="https://git.repository-pert.ismb.it/BRAIN-IoT/SmartBehaviourEventBus.git" target="_blank">SmartBehaviourEventBus</a> Git repository to this new module.</p>

<p>A part of the implementation of the <code class="language-plaintext highlighter-rouge">light</code> Smart Behavior in <code class="language-plaintext highlighter-rouge">RestComponentImpl.java</code> is:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cm">/**
 * This component represents two things:
 *  1. A Smart Light Bulb controlled using events
 *  2. A set of REST resources used by a web ui to display the light bulb
 */</span>
<span class="kn">import</span> <span class="nn">com.paremus.brain.iot.example.light.api.LightCommand</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.paremus.brain.iot.example.light.api.LightQuery</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.paremus.brain.iot.example.light.api.LightQueryResponse</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">eu.brain.iot.eventing.annotation.SmartBehaviourDefinition</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">eu.brain.iot.eventing.api.BrainIoTEvent</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">eu.brain.iot.eventing.api.EventBus</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">eu.brain.iot.eventing.api.SmartBehaviour</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.osgi.service.component.annotations.Component</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.osgi.service.component.annotations.Reference</span><span class="o">;</span>

<span class="nd">@Component</span><span class="o">(</span><span class="n">service</span><span class="o">=</span> <span class="o">{</span><span class="nc">SmartBehaviour</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="nc">RestComponentImpl</span><span class="o">.</span><span class="na">class</span><span class="o">})</span>
<span class="nd">@JaxrsResource</span>
<span class="nd">@HttpWhiteboardResource</span><span class="o">(</span><span class="n">pattern</span><span class="o">=</span><span class="s">"/light-ui/*"</span><span class="o">,</span> <span class="n">prefix</span><span class="o">=</span><span class="s">"/static"</span><span class="o">)</span>
<span class="nd">@JSONRequired</span>
<span class="nd">@SmartBehaviourDefinition</span><span class="o">(</span><span class="n">consumed</span> <span class="o">=</span> <span class="o">{</span><span class="nc">LightCommand</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="nc">LightQuery</span><span class="o">.</span><span class="na">class</span><span class="o">},</span> <span class="n">filter</span> <span class="o">=</span> <span class="s">"(brightness=*)"</span><span class="o">,</span>
        <span class="n">author</span> <span class="o">=</span> <span class="s">"Paremus"</span><span class="o">,</span> <span class="n">name</span> <span class="o">=</span> <span class="s">"Example Smart Light Bulb"</span><span class="o">,</span>
        <span class="n">description</span> <span class="o">=</span> <span class="s">"Implements a Smart Light Bulb and UI to display it."</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">RestComponentImpl</span> <span class="kd">implements</span> <span class="nc">SmartBehaviour</span><span class="o">&lt;</span><span class="nc">BrainIoTEvent</span><span class="o">&gt;{</span>

	<span class="nd">@Reference</span>
	<span class="kd">private</span> <span class="nc">EventBus</span> <span class="n">eventBus</span><span class="o">;</span>
   <span class="c1">//**</span>
	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">notify</span><span class="o">(</span><span class="nc">BrainIoTEvent</span> <span class="n">event</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">if</span><span class="o">(</span><span class="n">event</span> <span class="k">instanceof</span> <span class="nc">LightQuery</span><span class="o">)</span> <span class="o">{</span>
			<span class="nc">LightQueryResponse</span> <span class="n">response</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">LightQueryResponse</span><span class="o">();</span>
			<span class="n">response</span><span class="o">.</span><span class="na">requestor</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="na">sourceNode</span><span class="o">;</span>
			<span class="c1">//**  The internal process for consuming the event</span>
			<span class="n">eventBus</span><span class="o">.</span><span class="na">deliver</span><span class="o">(</span><span class="n">response</span><span class="o">);</span>

		<span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">event</span> <span class="k">instanceof</span> <span class="nc">LightCommand</span><span class="o">)</span> <span class="o">{</span>
			<span class="nc">LightCommand</span> <span class="n">command</span> <span class="o">=</span> <span class="o">(</span><span class="nc">LightCommand</span><span class="o">)</span> <span class="n">event</span><span class="o">;</span>	
         <span class="c1">//**  The internal process for consuming the event </span>
		<span class="o">}</span>
         <span class="c1">//**  other code</span>
	<span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>
<p>The important annotations include:</p>

<ul>
  <li>The @Component is used to register this component as an OSGi service.</li>
  <li>The @JaxrsResource annotation is used to mark this as a JAX-RS whiteboard resource</li>
  <li>The @JSONRequired is used to declare its JSON support requirement</li>
  <li>The @SmartBehaviourDefinition is used to define the <code class="language-plaintext highlighter-rouge">Provide-Capability</code> of the smart behaviour using the following properties:
    <ol>
      <li>‘consumed’: Specifies the typed events to be consumed by the smart behaviour. Here they are the <code class="language-plaintext highlighter-rouge">LightCommand</code> and the <code class="language-plaintext highlighter-rouge">LightCommand</code> events.</li>
      <li>‘filter’: A filter used to select the properties of the events that should be passed to this smart behaviour (only <code class="language-plaintext highlighter-rouge">LightCommand</code> here) from EventBus</li>
      <li>‘author’: The author of this smart behaviour</li>
      <li>‘name’: The name of this smart behaviour</li>
      <li>‘description’: The description of this smart behaviour</li>
    </ol>
  </li>
</ul>

<h4 id="integration-with-brain-iot-eventbus">Integration with BRAIN-IoT EventBus</h4>
<p>A smart behaviour has to integrate with BRAIN-IoT EventBus which is a referenced service in implementation as shown in above code:</p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Reference</span>
<span class="kd">private</span> <span class="nc">EventBus</span> <span class="n">eventBus</span><span class="o">;</span>
</code></pre></div></div>

<p>In addition, two important methods must be used:</p>
<ul>
  <li>The <code class="language-plaintext highlighter-rouge">notify(T extends BrainIoTEvent)</code> method provided by the SmartBehaviour API, for asynchronously receiving an event</li>
  <li>The <code class="language-plaintext highlighter-rouge">deliver(T extends BrainIoTEvent)</code> method provided by the EventBus, for asynchronously sending an event</li>
</ul>

<h4 id="light-bulb-rest-service-implementation">Light Bulb REST Service Implementation</h4>
<p>The web page of the light bulb will be implemented also in this <code class="language-plaintext highlighter-rouge">light.impl</code> module.</p>

<p>Create the directory <code class="language-plaintext highlighter-rouge">~/eventing-example/light.impl/src/main/resources</code> and copy the downloaded <code class="language-plaintext highlighter-rouge">light.impl/src/main/resources/static</code> folder which is the implementation of the light bulb page to the same place of current <code class="language-plaintext highlighter-rouge">light.impl</code> module (i.e. <code class="language-plaintext highlighter-rouge">~/eventing-example/light.impl/src/main/resources/static</code>).</p>

<div class="language-plaintext shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>~/eventing-example $ ls light.impl/src/main/resources/static
css  img  index.html  js  lib
</code></pre></div></div>

<h4 id="visibility-1">Visibility</h4>
<p class="note">Implementations should NOT be shared; hence no package-info.java file.</p>

<h2 id="build">Build</h2>

<p>It’s now time to build the <code class="language-plaintext highlighter-rouge">light</code> API and implementation modules and package it as a smart behaviour using the <code class="language-plaintext highlighter-rouge">smart-behaviour-maven-plugin</code> provided by BRAIN-IoT project. This plugin provides the <code class="language-plaintext highlighter-rouge">smart-behaviour</code> goal bound to the <code class="language-plaintext highlighter-rouge">package</code> phase for gathering all dependencies specified in the project pom file, as well as the project output jar by default and building a smart behaviour jar. The resulting smart behaviour jar file has the name in the form of <code class="language-plaintext highlighter-rouge">${project.artifactId}-${project.version}-brain-iot-smart-behaviour.jar</code>. And the smart-behaviour goal is not executed by default, therefore at least one explicit execution needs to be configured.</p>

<p>This plugin is optionally configurable using a bndrun file in its plugin’s configuration in the POM. The bndrun file is located in the base directory of the project. And this can be configured to specify an alternate path which can be absolute or relative to the base directory of the project. The bndrun file is used as a source of initial requirements or a list of bundles to be deployed on a BRAIN-IoT Fabric Fibre when Behaviour Management Service (BMS) searches in a marketplace. So, in general, this plugin can be used together with the <code class="language-plaintext highlighter-rouge">bnd-resolver-maven-plugin</code> for resolving the bndrun file in advance.</p>

<h4 id="build-setup">Build Setup</h4>
<p>Add the following <code class="language-plaintext highlighter-rouge">&lt;build&gt;</code> section in <code class="language-plaintext highlighter-rouge">light.impl</code> POM:</p>
<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>   <span class="nt">&lt;build&gt;</span>
        <span class="nt">&lt;plugins&gt;</span>
            <span class="c">&lt;!-- Expected to inherit configuration from a parent enRoute 
                pom. This includes -contract definitions and maven-jar-plugin setup --&gt;</span>
            <span class="nt">&lt;plugin&gt;</span>
                <span class="nt">&lt;groupId&gt;</span>biz.aQute.bnd<span class="nt">&lt;/groupId&gt;</span>
                <span class="nt">&lt;artifactId&gt;</span>bnd-maven-plugin<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;/plugin&gt;</span>
            <span class="nt">&lt;plugin&gt;</span>
                <span class="nt">&lt;groupId&gt;</span>org.apache.maven.plugins<span class="nt">&lt;/groupId&gt;</span>
                <span class="nt">&lt;artifactId&gt;</span>maven-jar-plugin<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;/plugin&gt;</span>
            <span class="c">&lt;!-- Validate that the smart behaviour can resolve --&gt;</span>
            <span class="nt">&lt;plugin&gt;</span>
                <span class="nt">&lt;groupId&gt;</span>biz.aQute.bnd<span class="nt">&lt;/groupId&gt;</span>
                <span class="nt">&lt;artifactId&gt;</span>bnd-resolver-maven-plugin<span class="nt">&lt;/artifactId&gt;</span>
                <span class="nt">&lt;executions&gt;</span>
                    <span class="nt">&lt;execution&gt;</span>
                        <span class="nt">&lt;goals&gt;</span>
                            <span class="nt">&lt;goal&gt;</span>resolve<span class="nt">&lt;/goal&gt;</span>
                        <span class="nt">&lt;/goals&gt;</span>
                        <span class="nt">&lt;phase&gt;</span>package<span class="nt">&lt;/phase&gt;</span>
                        <span class="nt">&lt;configuration&gt;</span>
                            <span class="nt">&lt;bndruns&gt;</span>
                                <span class="nt">&lt;bndrun&gt;</span>light.bndrun<span class="nt">&lt;/bndrun&gt;</span>
                            <span class="nt">&lt;/bndruns&gt;</span>
                        <span class="nt">&lt;/configuration&gt;</span>
                    <span class="nt">&lt;/execution&gt;</span>
                <span class="nt">&lt;/executions&gt;</span>
            <span class="nt">&lt;/plugin&gt;</span>
             <span class="nt">&lt;plugin&gt;</span>
                <span class="nt">&lt;groupId&gt;</span>com.paremus.brain.iot.maven<span class="nt">&lt;/groupId&gt;</span>
                <span class="nt">&lt;artifactId&gt;</span>smart-behaviour-maven-plugin<span class="nt">&lt;/artifactId&gt;</span>
                <span class="nt">&lt;version&gt;</span>0.0.1-SNAPSHOT<span class="nt">&lt;/version&gt;</span>
                <span class="nt">&lt;executions&gt;</span>
					<span class="nt">&lt;execution&gt;</span>
						<span class="nt">&lt;goals&gt;</span>
							<span class="nt">&lt;goal&gt;</span>smart-behaviour<span class="nt">&lt;/goal&gt;</span>
						<span class="nt">&lt;/goals&gt;</span>
						<span class="nt">&lt;configuration&gt;</span>
						    <span class="nt">&lt;bndrun&gt;</span>light.bndrun<span class="nt">&lt;/bndrun&gt;</span>
						<span class="nt">&lt;/configuration&gt;</span>
					<span class="nt">&lt;/execution&gt;</span>
				<span class="nt">&lt;/executions&gt;</span>
            <span class="nt">&lt;/plugin&gt;</span>
        <span class="nt">&lt;/plugins&gt;</span>
    <span class="nt">&lt;/build&gt;</span>
</code></pre></div></div>
<p>Create a <code class="language-plaintext highlighter-rouge">bndrun</code> file:</p>

<div class="language-plaintext shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>~/eventing-example $ touch light.impl/light.bndrun
</code></pre></div></div>
<p>Then add the following content in <code class="language-plaintext highlighter-rouge">light.bndrun</code>:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">-runrequires</span>: <span class="se">\</span>
   bnd.identity<span class="p">;</span><span class="nb">id</span><span class="o">=</span><span class="s1">'com.paremus.brain.iot.example.light.impl'</span>,<span class="se">\</span>
	bnd.identity<span class="p">;</span><span class="nb">id</span><span class="o">=</span><span class="s1">'org.apache.aries.jax.rs.jackson'</span>

<span class="nt">-runfw</span>: org.eclipse.osgi
<span class="nt">-runee</span>: JavaSE-1.8

<span class="nt">-resolve</span>.effective: active
</code></pre></div></div>

<p>As shown above, the bndrun contains a <code class="language-plaintext highlighter-rouge">runrequires</code> statement that specifies the required bundles to be deployed at runtime. here we put the <code class="language-plaintext highlighter-rouge">light.impl</code> module and its JAX-RS whiteboard dependency.</p>

<p class="note">Note that your runee may be different if you chose to use a higher version of Java</p>

<p>However, no <code class="language-plaintext highlighter-rouge">runbundles</code> is currently listed(i.e. the actual bundles needed at runtime to run the <code class="language-plaintext highlighter-rouge">light</code> smart behaviour). But the bndrun will be automatically resolved using the <code class="language-plaintext highlighter-rouge">bnd-resolver-maven-plugin</code> to generate the runtime dependencies. Now we use the <code class="language-plaintext highlighter-rouge">package</code> goal to check that the code compiles and can be successfully packaged into a bundle.</p>

<p>Build the <code class="language-plaintext highlighter-rouge">eventing-example</code> project:</p>

<div class="language-plaintext shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>~/eventing-example $ mvn package
[INFO] Scanning for projects...                                                                    
[INFO] ------------------------------------------------------------------------
[INFO] Building light.impl 0.0.1-SNAPSHOT
[INFO] ------------------------------------------------------------------------
[INFO] --- maven-jar-plugin:3.0.2:jar (default-jar) @ light.impl ---
[INFO] Building jar: /home/rui/Documents/SmartBehaviourEventBus/eventing-example/light.impl/target/light.impl-0.0.1-SNAPSHOT.jar
[INFO] 
[INFO] --- bnd-resolver-maven-plugin:5.1.2:resolve (default) @ light.impl ---
[INFO] 
[INFO] --- smart-behaviour-maven-plugin:0.0.1-SNAPSHOT:smart-behaviour (default) @ light.impl ---
[INFO] Gathering dependencies
[INFO] Copying light.api-0.0.1-SNAPSHOT.jar to ~/eventing-example/light.impl/target/smart-behaviour/light.api-0.0.1-SNAPSHOT.jar
[INFO] Copying light.impl-0.0.1-SNAPSHOT.jar to ~/eventing-example/light.impl/target/smart-behaviour/light.impl-0.0.1-SNAPSHOT.jar
[INFO] Copying .....
[INFO] Processing ~/eventing-example/light.impl/light.bndrun for dependencies
[INFO] Building jar: ~/eventing-example/light.impl/target/light.impl-0.0.1-SNAPSHOT-brain-iot-smart-behaviour.jar
[INFO] ------------------------------------------------------------------------
[INFO] BUILD SUCCESS
[INFO] ------------------------------------------------------------------------
</code></pre></div></div>
<p class="note">If we had tests or other post-packaging checks then we could have used the <code class="language-plaintext highlighter-rouge">verify</code> goal instead.</p>
<p class="warning">If the package fails then check your code and try again. Once you can package it cleanly then continue to the next stage.</p>

<p>You can see each module has been packaged as an OSGi bundle in their <code class="language-plaintext highlighter-rouge">target</code> directories. Check the output of the <code class="language-plaintext highlighter-rouge">light.impl</code> module:</p>

<div class="language-plaintext shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>~/eventing-example $ cd light.impl
~/eventing-example/light.impl $ ls target
classes                                                  maven-status
generated-sources                                        smart-behaviour
generated-test-sources                                   surefire-reports
light.impl-0.0.1-SNAPSHOT-brain-iot-smart-behaviour.jar  test-classes
light.impl-0.0.1-SNAPSHOT.jar                            tmp
maven-archiver
</code></pre></div></div>
<p>In the <code class="language-plaintext highlighter-rouge">light.impl/target</code> folder, there is the <code class="language-plaintext highlighter-rouge">light.impl-0.0.1-SNAPSHOT.jar</code> module output bundle, but also the <code class="language-plaintext highlighter-rouge">light.impl-0.0.1-SNAPSHOT-brain-iot-smart-behaviour.jar</code> smart behaviour jar, and a <code class="language-plaintext highlighter-rouge">smart-behaviour</code> folder with all the gathered dependencies for the <code class="language-plaintext highlighter-rouge">light</code> smart behaviour and a an OSGi repository index file is generated from the dependencies. The <code class="language-plaintext highlighter-rouge">index.xml</code> can be used for resolving the smart behaviour at runtime. You can also use the <code class="language-plaintext highlighter-rouge">mvn install</code> to deploy the jars in maven local repository for creating a marketplace later.</p>

<p>Check the content of the output bundle, run:</p>

<div class="language-plaintext shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>~/eventing-example/light.impl $ bnd print target/light.impl-0.0.1-SNAPSHOT.jar
[MANIFEST light.impl-0.0.1-SNAPSHOT]
......                                    
Bundle-Description                       "The light.impl DS component - built using OSGi enRoute R7"
Bundle-ManifestVersion                   2                                       
Bundle-Name                              light.impl                              
Bundle-SymbolicName                      com.paremus.brain.iot.example.light.impl
Bundle-Version                           0.0.1.202009251653                      
Created-By                               1.8.0_221 (Oracle Corporation)
Import-Package: com.paremus.brain.iot.example.light.api;version="[1.0,2)"....
Require-Capability:....
Service-Component: OSGI-INF/com.paremus.brain.iot.example.light.impl.RestComponentImpl.xml
Provide-Capability: osgi.service;objectClass:List&lt;String&gt;="com.paremus.brain.iot.example.light.impl.RestComponentImpl,
    eu.brain.iot.eventing.api.SmartBehaviour",
    eu.brain.iot.behaviour;consumed:List&lt;String&gt;="com.paremus.brain.iot.example.light.api.LightCommand,
    com.paremus.brain.iot.example.light.api.LightQuery";author=Paremus;name="Example Smart Light Bulb";
    description="Implements a Smart Light Bulb and UI to display it."
Service-Component: OSGI-INF/com.paremus.brain.iot.example.light.impl.RestComponentImpl.xml
</code></pre></div></div>
<p>As shown, the event types to be consumed by the bundle are listed in the <code class="language-plaintext highlighter-rouge">consumed</code> property.</p>

<p>If you look again at the <code class="language-plaintext highlighter-rouge">light.bndrun</code> file you will now see a number of bundles required at runtime are now listed by <code class="language-plaintext highlighter-rouge">runbundles</code> instruction.</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">-runrequires</span>: <span class="se">\</span>
	bnd.identity<span class="p">;</span><span class="nb">id</span><span class="o">=</span><span class="s1">'com.paremus.brain.iot.example.light.impl'</span>,<span class="se">\</span>
	bnd.identity<span class="p">;</span><span class="nb">id</span><span class="o">=</span><span class="s1">'org.apache.aries.jax.rs.jackson'</span>
	
<span class="nt">-runfw</span>: org.eclipse.osgi
<span class="nt">-runee</span>: JavaSE-1.8

<span class="nt">-runproperties</span>: org.osgi.service.http.port<span class="o">=</span>8082

<span class="nt">-resolve</span>.effective: active
<span class="nt">-runbundles</span>: <span class="se">\</span>
	ch.qos.logback.classic<span class="p">;</span><span class="nv">version</span><span class="o">=</span><span class="s1">'[1.2.3,1.2.4)'</span>,<span class="se">\</span>
	ch.qos.logback.core<span class="p">;</span><span class="nv">version</span><span class="o">=</span><span class="s1">'[1.2.3,1.2.4)'</span>,<span class="se">\</span>
	com.paremus.brain.iot.eventing.api<span class="p">;</span><span class="nv">version</span><span class="o">=</span><span class="s1">'[0.0.1,0.0.2)'</span>,<span class="se">\</span>
	com.paremus.brain.iot.eventing.impl<span class="p">;</span><span class="nv">version</span><span class="o">=</span><span class="s1">'[0.0.1,0.0.2)'</span>,<span class="se">\</span>
	com.paremus.brain.iot.example.light.api<span class="p">;</span><span class="nv">version</span><span class="o">=</span><span class="s1">'[0.0.1,0.0.2)'</span>,<span class="se">\</span>
	com.paremus.brain.iot.example.light.impl<span class="p">;</span><span class="nv">version</span><span class="o">=</span><span class="s1">'[0.0.1,0.0.2)'</span>,<span class="se">\</span>
	org.apache.aries.jax.rs.whiteboard<span class="p">;</span><span class="nv">version</span><span class="o">=</span><span class="s1">'[1.0.1,1.0.2)'</span>,<span class="se">\</span>
	org.apache.felix.configadmin<span class="p">;</span><span class="nv">version</span><span class="o">=</span><span class="s1">'[1.9.8,1.9.9)'</span>,<span class="se">\</span>
	org.apache.felix.http.jetty<span class="p">;</span><span class="nv">version</span><span class="o">=</span><span class="s1">'[4.0.6,4.0.7)'</span>,<span class="se">\</span>
	org.apache.felix.http.servlet-api<span class="p">;</span><span class="nv">version</span><span class="o">=</span><span class="s1">'[1.1.2,1.1.3)'</span>,<span class="se">\</span>
	org.apache.felix.scr<span class="p">;</span><span class="nv">version</span><span class="o">=</span><span class="s1">'[2.1.10,2.1.11)'</span>,<span class="se">\</span>
	org.apache.servicemix.specs.annotation-api-1.3<span class="p">;</span><span class="nv">version</span><span class="o">=</span><span class="s1">'[1.3.0,1.3.1)'</span>,<span class="se">\</span>
	org.osgi.service.jaxrs<span class="p">;</span><span class="nv">version</span><span class="o">=</span><span class="s1">'[1.0.0,1.0.1)'</span>,<span class="se">\</span>
	org.osgi.util.function<span class="p">;</span><span class="nv">version</span><span class="o">=</span><span class="s1">'[1.1.0,1.1.1)'</span>,<span class="se">\</span>
	org.osgi.util.promise<span class="p">;</span><span class="nv">version</span><span class="o">=</span><span class="s1">'[1.1.0,1.1.1)'</span>,<span class="se">\</span>
	slf4j.api<span class="p">;</span><span class="nv">version</span><span class="o">=</span><span class="s1">'[1.7.25,1.7.26)'</span>,<span class="se">\</span>
	com.fasterxml.jackson.core.jackson-annotations<span class="p">;</span><span class="nv">version</span><span class="o">=</span><span class="s1">'[2.9.0,2.9.1)'</span>,<span class="se">\</span>
	com.fasterxml.jackson.core.jackson-core<span class="p">;</span><span class="nv">version</span><span class="o">=</span><span class="s1">'[2.9.6,2.9.7)'</span>,<span class="se">\</span>
	com.fasterxml.jackson.core.jackson-databind<span class="p">;</span><span class="nv">version</span><span class="o">=</span><span class="s1">'[2.9.6,2.9.7)'</span>,<span class="se">\</span>
	com.fasterxml.jackson.jaxrs.jackson-jaxrs-base<span class="p">;</span><span class="nv">version</span><span class="o">=</span><span class="s1">'[2.9.6,2.9.7)'</span>,<span class="se">\</span>
	com.fasterxml.jackson.jaxrs.jackson-jaxrs-json-provider<span class="p">;</span><span class="nv">version</span><span class="o">=</span><span class="s1">'[2.9.6,2.9.7)'</span>,<span class="se">\</span>
	com.fasterxml.jackson.module.jackson-module-jaxb-annotations<span class="p">;</span><span class="nv">version</span><span class="o">=</span><span class="s1">'[2.9.6,2.9.7)'</span>,<span class="se">\</span>
	org.apache.aries.jax.rs.jackson<span class="p">;</span><span class="nv">version</span><span class="o">=</span><span class="s1">'[1.0.2,1.0.3)'</span>,<span class="se">\</span>
	org.osgi.util.pushstream<span class="p">;</span><span class="nv">version</span><span class="o">=</span><span class="s1">'[1.0.0,1.0.1)'</span>,<span class="se">\</span>
	org.apache.aries.javax.jax.rs-api<span class="p">;</span><span class="nv">version</span><span class="o">=</span><span class="s1">'[1.0.1,1.0.2)'</span>,<span class="se">\</span>
	com.paremus.brain.iot.message.integrity.api<span class="p">;</span><span class="nv">version</span><span class="o">=</span><span class="s1">'[0.0.1,0.0.2)'</span>,<span class="se">\</span>
	com.paremus.brain.iot.message.integrity.insecure.impl<span class="p">;</span><span class="nv">version</span><span class="o">=</span><span class="s1">'[0.0.1,0.0.2)'</span>
</code></pre></div></div>

<h3 id="smart-behaviour">Smart Behaviour</h3>
<p>The <code class="language-plaintext highlighter-rouge">light.impl</code> module is also packaged as a smart behaviour jar using the <code class="language-plaintext highlighter-rouge">smart-behaviour-maven-plugin</code>.</p>

<p>Check the content of the <code class="language-plaintext highlighter-rouge">light</code> smart behaviour jar:</p>

<div class="language-plaintext shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>~/eventing-example/light.impl $ bnd print target/light.impl-0.0.1-SNAPSHOT-brain-iot-smart-behaviour.jar

[MANIFEST light.impl-0.0.1-SNAPSHOT-brain-iot-smart-behaviour]
BRAIN-IoT-Deploy-Requirement     osgi.identity;filter:="(osgi.identity=com.paremus.brain.iot.example.light.impl)",
                                 osgi.identity;filter:="(osgi.identity=org.apache.aries.jax.rs.jackson)"
BRAIN-IoT-Smart-Behaviour-SymbolicName   com.paremus.brain.iot.example.light.impl
BRAIN-IoT-Smart-Behaviour-Version        0.0.1.SNAPSHOT                          
Build-Jdk                                1.8.0_221                                                                    
Created-By                               Apache Maven 3.3.9                      
Manifest-Version                         1.0
</code></pre></div></div>
<p>Each smart behaviour will have some OSGi headers. The value of <code class="language-plaintext highlighter-rouge">BRAIN-IoT-Deploy-Requirement</code> header is drived from the <code class="language-plaintext highlighter-rouge">-runrequires</code> instruction in the bndrun file (e.g. <code class="language-plaintext highlighter-rouge">light.bndrun</code> here), and the bundles specified in this header will be resolved and installed together with their dependencies at runtime. If the <code class="language-plaintext highlighter-rouge">smart-behaviour-maven-plugin</code> is not configured with any <code class="language-plaintext highlighter-rouge">bndrun</code> file, then the default bundle must be deployed is the project output jar.</p>

<h2 id="create-the-sensor-and-controller-smart-behaviours">Create the Sensor and Controller Smart Behaviours</h2>
<p>Let’s create sub-modules <code class="language-plaintext highlighter-rouge">sensor.api</code>, <code class="language-plaintext highlighter-rouge">sensor.impl</code> and <code class="language-plaintext highlighter-rouge">behaviour.impl</code> in <code class="language-plaintext highlighter-rouge">eventing-example</code> parent project. The controller Smart Behaviour is named as <code class="language-plaintext highlighter-rouge">behaviour.impl</code>.</p>

<h3 id="create-sensor-api-module">Create Sensor API Module</h3>

<p>Change directory into the parent <code class="language-plaintext highlighter-rouge">eventing-example</code> project directory, then create an API module <code class="language-plaintext highlighter-rouge">sensor.api</code> using the <a href="https://enroute.osgi.org/about/112-enRoute-Archetypes.html#the-api-archetype" target="_blank">api Archetype</a> as shown:</p>

<div class="language-plaintext shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>~ $ cd eventing-example
~/eventing-example $ mvn archetype:generate \
     -DarchetypeGroupId=org.osgi.enroute.archetype \
     -DarchetypeArtifactId=api \
     -DarchetypeVersion=7.0.0
</code></pre></div></div>
<p>with the following values:</p>

<div class="language-plaintext shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Define value for property 'groupId': com.paremus.brain.iot.example
Define value for property 'artifactId': sensor.api
Define value for property 'version' 1.0-SNAPSHOT: : 0.0.1-SNAPSHOT
Define value for property 'package' com.paremus.brain.iot.example.sensor.api: : 
Confirm properties configuration:
groupId: com.paremus.brain.iot.example
artifactId: sensor.api
version: 0.0.1-SNAPSHOT
package: com.paremus.brain.iot.example.sensor.api
 Y: :
</code></pre></div></div>
<p>This API module defines the Events via the use of <a href="https://enroute.osgi.org/FAQ/420-dtos.html" target="_blank">Data Transfer Objects (DTOs)</a> transfered between <code class="language-plaintext highlighter-rouge">sensor</code> smart behaviour and others.</p>

<h4 id="dependencies-2">Dependencies</h4>

<p>Similar with the Light API module, open pom.xml of <code class="language-plaintext highlighter-rouge">sensor.api</code> and add following <code class="language-plaintext highlighter-rouge">eventing.api</code> dependency:</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>com.paremus.brain.iot<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>eventing.api<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;version&gt;</span>0.0.1-SNAPSHOT<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</code></pre></div></div>
<h4 id="visibility-2">Visibility</h4>
<p>The <code class="language-plaintext highlighter-rouge">sensor.api</code> package is also exported by the automatically generated file <code class="language-plaintext highlighter-rouge">~/eventing-example/sensor.api/src/main/java/com/paremus/brain/iot/example/sensor/api/package-info.java</code>.</p>

<h4 id="sensor-events">Sensor Events</h4>
<p>Remove original auto-generated java classes in src package:</p>

<p><code class="language-plaintext highlighter-rouge">~/eventing-example/sensor.api/src/main/java/com/paremus/brain/iot/example/sensor/api/ProviderInterface.java</code></p>

<p><code class="language-plaintext highlighter-rouge">~/eventing-example/sensor.api/src/main/java/com/paremus/brain/iot/example/sensor/api/ConsumerInterface.java</code></p>

<p>and create the following file:</p>

<p><code class="language-plaintext highlighter-rouge">~/eventing-example/sensor.api/src/main/java/com/paremus/brain/iot/example/sensor/api/AbstractLightDTO.java</code></p>

<p>
  <a class="btn btn-primary" data-toggle="collapse" href="#SensorReadingDTO" aria-expanded="false" aria-controls="SensorReadingDTO.java">SensorReadingDTO.java</a>
</p>

<div class="collapse" id="SensorReadingDTO">
  <div class="card card-block">

<figure class="highlight"><pre><code class="language-properties" data-lang="properties"><span class="err">/*</span> <span class="err">Copyright</span> <span class="err">2019</span> <span class="err">Paremus,</span> <span class="err">Ltd</span> <span class="err">-</span> <span class="err">All</span> <span class="err">Rights</span> <span class="err">Reserved</span>
 <span class="err">*</span> <span class="err">Unauthorized</span> <span class="err">copying</span> <span class="err">of</span> <span class="err">this</span> <span class="err">file,</span> <span class="err">via</span> <span class="err">any</span> <span class="err">medium</span> <span class="err">is</span> <span class="err">strictly</span> <span class="err">prohibited</span>
 <span class="err">*</span> <span class="err">Proprietary</span> <span class="err">and</span> <span class="err">confidential</span>
 <span class="err">*/</span>
<span class="err">package</span> <span class="err">com.paremus.brain.iot.example.sensor.api;</span>

<span class="err">import</span> <span class="err">eu.brain.iot.eventing.api.BrainIoTEvent;</span>

<span class="err">public</span> <span class="err">class</span> <span class="err">SensorReadingDTO</span> <span class="err">extends</span> <span class="err">BrainIoTEvent</span> <span class="err">{</span>

<span class="err">}</span></code></pre></figure>

  </div>
</div>

<h3 id="create-sensor-implementation-module">Create Sensor Implementation Module</h3>
<p>Go to <code class="language-plaintext highlighter-rouge">eventing-example</code> project directory, create the <code class="language-plaintext highlighter-rouge">sensor.impl</code> module using the <a href="https://enroute.osgi.org/about/112-enRoute-Archetypes.html#the-rest-component-archetype" target="_blank">rest-component Archetype</a>:</p>

<div class="language-plaintext shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>~/eventing-example $ mvn archetype:generate \
     -DarchetypeGroupId=org.osgi.enroute.archetype \
     -DarchetypeArtifactId=rest-component \
     -DarchetypeVersion=7.0.0
</code></pre></div></div>
<p>with the following values:</p>

<div class="language-plaintext shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Define value for property 'groupId': com.paremus.brain.iot.example
Define value for property 'artifactId': sensor.impl
Define value for property 'version' 1.0-SNAPSHOT: : 0.0.1-SNAPSHOT
Define value for property 'package' com.paremus.brain.iot.example.sensor.impl: : 
Confirm properties configuration:
groupId: com.paremus.brain.iot.example
artifactId: sensor.impl
version: 0.0.1-SNAPSHOT
package: com.paremus.brain.iot.example.sensor.impl
 Y: :
</code></pre></div></div>
<h4 id="dependencies-3">Dependencies</h4>
<p>Replace the auto-genearted POM in this module with the following, the content is similar with the <code class="language-plaintext highlighter-rouge">light.impl</code> POM with the build configuartion:</p>
<p>
  <a class="btn btn-primary" data-toggle="collapse" href="#sensor-pom" aria-expanded="false" aria-controls="sensor-pom">pom.xml</a>
</p>

<div class="collapse" id="sensor-pom">
  <div class="card card-block">

<figure class="highlight"><pre><code class="language-properties" data-lang="properties"><span class="err">&lt;?xml</span> <span class="py">version</span><span class="p">=</span><span class="s">"1.0"</span> <span class="s">encoding="UTF-8"?&gt;</span>
<span class="err">&lt;project</span> <span class="py">xmlns</span><span class="p">=</span><span class="s">"http://maven.apache.org/POM/4.0.0"</span> <span class="s">xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"&gt;</span>
    <span class="err">&lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;</span>
    <span class="err">&lt;parent&gt;</span>
    <span class="err">&lt;artifactId&gt;eventing-example&lt;/artifactId&gt;</span>
    <span class="err">&lt;groupId&gt;com.paremus.brain.iot.example&lt;/groupId&gt;</span>
    <span class="err">&lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt;</span>
  <span class="err">&lt;/parent&gt;</span>

    <span class="err">&lt;groupId&gt;com.paremus.brain.iot.example&lt;/groupId&gt;</span>
    <span class="err">&lt;artifactId&gt;sensor.impl&lt;/artifactId&gt;</span>
    <span class="err">&lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt;</span>

    <span class="err">&lt;description&gt;The</span> <span class="err">sensor.impl</span> <span class="err">DS</span> <span class="err">component</span> <span class="err">-</span> <span class="err">built</span> <span class="err">using</span> <span class="err">OSGi</span> <span class="err">enRoute</span> <span class="err">R7&lt;/description&gt;</span>

    <span class="err">&lt;dependencies&gt;</span>
        <span class="err">&lt;dependency&gt;</span>
            <span class="err">&lt;groupId&gt;org.osgi.enroute&lt;/groupId&gt;</span>
            <span class="err">&lt;artifactId&gt;osgi-api&lt;/artifactId&gt;</span>
            <span class="err">&lt;type&gt;pom&lt;/type&gt;</span>
        <span class="err">&lt;/dependency&gt;</span>
        <span class="err">&lt;dependency&gt;</span>
            <span class="err">&lt;groupId&gt;org.osgi.enroute&lt;/groupId&gt;</span>
            <span class="err">&lt;artifactId&gt;enterprise-api&lt;/artifactId&gt;</span>
            <span class="err">&lt;type&gt;pom&lt;/type&gt;</span>
        <span class="err">&lt;/dependency&gt;</span>
        <span class="err">&lt;dependency&gt;</span>
            <span class="err">&lt;groupId&gt;org.osgi.enroute&lt;/groupId&gt;</span>
            <span class="err">&lt;artifactId&gt;test-bundles&lt;/artifactId&gt;</span>
            <span class="err">&lt;type&gt;pom&lt;/type&gt;</span>
        <span class="err">&lt;/dependency&gt;</span>
        <span class="err">&lt;dependency&gt;</span>
            <span class="err">&lt;groupId&gt;com.paremus.brain.iot.example&lt;/groupId&gt;</span>
            <span class="err">&lt;artifactId&gt;sensor.api&lt;/artifactId&gt;</span>
            <span class="err">&lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt;</span>
        <span class="err">&lt;/dependency&gt;</span>
        <span class="err">&lt;dependency&gt;</span>
            <span class="err">&lt;groupId&gt;com.paremus.brain.iot&lt;/groupId&gt;</span>
            <span class="err">&lt;artifactId&gt;eventing.api&lt;/artifactId&gt;</span>
        <span class="err">&lt;/dependency&gt;</span>
        <span class="err">&lt;dependency&gt;</span>
            <span class="err">&lt;groupId&gt;org.osgi.enroute&lt;/groupId&gt;</span>
            <span class="err">&lt;artifactId&gt;impl-index&lt;/artifactId&gt;</span>
            <span class="err">&lt;type&gt;pom&lt;/type&gt;</span>
            <span class="err">&lt;scope&gt;runtime&lt;/scope&gt;</span>
        <span class="err">&lt;/dependency&gt;</span>
        <span class="err">&lt;dependency&gt;</span>
            <span class="err">&lt;groupId&gt;org.apache.aries.jax.rs&lt;/groupId&gt;</span>
            <span class="err">&lt;artifactId&gt;org.apache.aries.jax.rs.jackson&lt;/artifactId&gt;</span>
        <span class="err">&lt;/dependency&gt;</span>
        <span class="err">&lt;dependency&gt;</span>
            <span class="err">&lt;groupId&gt;com.paremus.brain.iot&lt;/groupId&gt;</span>
            <span class="err">&lt;artifactId&gt;eventing.impl&lt;/artifactId&gt;</span>
        <span class="err">&lt;/dependency&gt;</span>
        <span class="err">&lt;dependency&gt;</span>
            <span class="err">&lt;groupId&gt;com.paremus.brain.iot&lt;/groupId&gt;</span>
            <span class="err">&lt;artifactId&gt;message.integrity.insecure.impl&lt;/artifactId&gt;</span>
        <span class="err">&lt;/dependency&gt;</span>
     <span class="err">&lt;/dependencies&gt;</span>

    <span class="err">&lt;build&gt;</span>
        <span class="err">&lt;plugins&gt;</span>
            <span class="err">&lt;</span><span class="c">!-- Expected to inherit configuration from a parent enRoute 
</span>                <span class="err">pom.</span> <span class="err">This</span> <span class="err">includes</span> <span class="err">-contract</span> <span class="err">definitions</span> <span class="err">and</span> <span class="err">maven-jar-plugin</span> <span class="err">setup</span> <span class="err">--&gt;</span>
            <span class="err">&lt;plugin&gt;</span>
                <span class="err">&lt;groupId&gt;biz.aQute.bnd&lt;/groupId&gt;</span>
                <span class="err">&lt;artifactId&gt;bnd-maven-plugin&lt;/artifactId&gt;</span>
            <span class="err">&lt;/plugin&gt;</span>
            <span class="err">&lt;plugin&gt;</span>
                <span class="err">&lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;</span>
                <span class="err">&lt;artifactId&gt;maven-jar-plugin&lt;/artifactId&gt;</span>
            <span class="err">&lt;/plugin&gt;</span>
            <span class="err">&lt;</span><span class="c">!-- Validate that the smart behaviour can resolve --&gt;
</span>            <span class="err">&lt;plugin&gt;</span>
                <span class="err">&lt;groupId&gt;biz.aQute.bnd&lt;/groupId&gt;</span>
                <span class="err">&lt;artifactId&gt;bnd-resolver-maven-plugin&lt;/artifactId&gt;</span>
                <span class="err">&lt;executions&gt;</span>
                    <span class="err">&lt;execution&gt;</span>
                        <span class="err">&lt;goals&gt;</span>
                            <span class="err">&lt;goal&gt;resolve&lt;/goal&gt;</span>
                        <span class="err">&lt;/goals&gt;</span>
                        <span class="err">&lt;phase&gt;package&lt;/phase&gt;</span>
                        <span class="err">&lt;configuration&gt;</span>
                            <span class="err">&lt;bndruns&gt;</span>
                                <span class="err">&lt;bndrun&gt;sensor.bndrun&lt;/bndrun&gt;</span>
                            <span class="err">&lt;/bndruns&gt;</span>
                        <span class="err">&lt;/configuration&gt;</span>
                    <span class="err">&lt;/execution&gt;</span>
                <span class="err">&lt;/executions&gt;</span>
            <span class="err">&lt;/plugin&gt;</span>
            <span class="err">&lt;plugin&gt;</span>
                <span class="err">&lt;groupId&gt;com.paremus.brain.iot.maven&lt;/groupId&gt;</span>
                <span class="err">&lt;artifactId&gt;smart-behaviour-maven-plugin&lt;/artifactId&gt;</span>
                <span class="err">&lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt;</span>
                <span class="err">&lt;executions&gt;</span>
					<span class="err">&lt;execution&gt;</span>
						<span class="err">&lt;goals&gt;</span>
							<span class="err">&lt;goal&gt;smart-behaviour&lt;/goal&gt;</span>
						<span class="err">&lt;/goals&gt;</span>
						<span class="err">&lt;configuration&gt;</span>
                            <span class="err">&lt;bndrun&gt;sensor.bndrun&lt;/bndrun&gt;</span>
                        <span class="err">&lt;/configuration&gt;</span>
					<span class="err">&lt;/execution&gt;</span>
				<span class="err">&lt;/executions&gt;</span>
            <span class="err">&lt;/plugin&gt;</span>
        <span class="err">&lt;/plugins&gt;</span>
    <span class="err">&lt;/build&gt;</span>
<span class="err">&lt;/project&gt;</span></code></pre></figure>

  </div>
</div>

<h4 id="implement-the-sensor-smart-behaviour">Implement the <code class="language-plaintext highlighter-rouge">sensor</code> smart behaviour</h4>
<p>Overwrite original auto-generated java class in src package for the sensor smart behaviour implementation:</p>

<p><code class="language-plaintext highlighter-rouge">~/eventing-example/sensor.impl/src/main/java/com/paremus/brain/iot/example/sensor/impl/RestComponentImpl.java</code></p>

<p>
  <a class="btn btn-primary" data-toggle="collapse" href="#sensor-RestComponentImpl" aria-expanded="false" aria-controls="sensor-RestComponentImpl.java">RestComponentImpl.java</a>
</p>

<div class="collapse" id="sensor-RestComponentImpl">
  <div class="card card-block">

<figure class="highlight"><pre><code class="language-properties" data-lang="properties"><span class="err">/*</span> <span class="err">Copyright</span> <span class="err">2019</span> <span class="err">Paremus,</span> <span class="err">Ltd</span> <span class="err">-</span> <span class="err">All</span> <span class="err">Rights</span> <span class="err">Reserved</span>
 <span class="err">*</span> <span class="err">Unauthorized</span> <span class="err">copying</span> <span class="err">of</span> <span class="err">this</span> <span class="err">file,</span> <span class="err">via</span> <span class="err">any</span> <span class="err">medium</span> <span class="err">is</span> <span class="err">strictly</span> <span class="err">prohibited</span>
 <span class="err">*</span> <span class="err">Proprietary</span> <span class="err">and</span> <span class="err">confidential</span>
 <span class="err">*/</span>
<span class="err">package</span> <span class="err">com.paremus.brain.iot.example.sensor.impl;</span>

<span class="err">import</span> <span class="err">com.paremus.brain.iot.example.sensor.api.SensorReadingDTO;</span>
<span class="err">import</span> <span class="err">eu.brain.iot.eventing.annotation.SmartBehaviourDefinition;</span>
<span class="err">import</span> <span class="err">eu.brain.iot.eventing.api.EventBus;</span>
<span class="err">import</span> <span class="err">org.osgi.service.component.annotations.Component;</span>
<span class="err">import</span> <span class="err">org.osgi.service.component.annotations.Reference;</span>
<span class="err">import</span> <span class="err">org.osgi.service.http.whiteboard.propertytypes.HttpWhiteboardResource;</span>
<span class="err">import</span> <span class="err">org.osgi.service.jaxrs.whiteboard.propertytypes.JaxrsResource;</span>

<span class="err">import</span> <span class="err">javax.ws.rs.POST;</span>
<span class="err">import</span> <span class="err">javax.ws.rs.Path;</span>

<span class="err">/**</span>
 <span class="err">*</span> <span class="err">This</span> <span class="err">component</span> <span class="err">triggers</span> <span class="err">sensor</span> <span class="err">readings</span> <span class="err">based</span> <span class="err">on</span> <span class="err">web</span> <span class="err">clicks</span>
 <span class="err">*/</span>
<span class="err">@Component(</span><span class="py">service</span><span class="p">=</span><span class="s">RestComponentImpl.class)</span>
<span class="err">@JaxrsResource</span>
<span class="err">@HttpWhiteboardResource(</span><span class="py">pattern</span><span class="p">=</span><span class="s">"/sensor-ui/*", prefix="/static")</span>
<span class="err">//</span> <span class="err">SmartBehaviourDefinition</span> <span class="err">is</span> <span class="err">just</span> <span class="err">so</span> <span class="err">example</span> <span class="err">sensor</span> <span class="err">is</span> <span class="err">added</span> <span class="err">to</span> <span class="err">repository</span>
<span class="err">@SmartBehaviourDefinition(</span><span class="py">consumed</span> <span class="p">=</span> <span class="s">{}, // this component does not consume events</span>
        <span class="py">author</span> <span class="p">=</span> <span class="s">"Paremus", name = "Example Smart Security Sensor",</span>
        <span class="py">description</span> <span class="p">=</span> <span class="s">"Implements a Smart Security Sensor and UI to display it.")</span>
<span class="err">public</span> <span class="err">class</span> <span class="err">RestComponentImpl</span> <span class="err">{</span>

    <span class="err">@Reference</span>
    <span class="err">private</span> <span class="err">EventBus</span> <span class="err">eventBus;</span>

    <span class="err">@Path("sensor")</span>
    <span class="err">@POST</span>
    <span class="err">public</span> <span class="err">void</span> <span class="err">trigger()</span> <span class="err">{</span>
        <span class="err">eventBus.deliver(new</span> <span class="err">SensorReadingDTO());</span>
    <span class="err">}</span>

<span class="err">}</span></code></pre></figure>

  </div>
</div>
<p class="note">The <code class="language-plaintext highlighter-rouge">sensor</code> smart behaviour is designed to just send the <code class="language-plaintext highlighter-rouge">SensorReadingDTO</code> trigger event, so its <code class="language-plaintext highlighter-rouge">consumed</code> property of the <code class="language-plaintext highlighter-rouge">@SmartBehaviourDefinition</code> annotation is empty.</p>

<p>In addition, place the following <code class="language-plaintext highlighter-rouge">sensor.bndrun</code> file in <code class="language-plaintext highlighter-rouge">~/eventing-example/sensor.impl/</code> for configuration of <code class="language-plaintext highlighter-rouge">smart-behaviour-maven-plugin</code>.</p>
<p>
  <a class="btn btn-primary" data-toggle="collapse" href="#sensor.bndrun" aria-expanded="false" aria-controls="sensor.bndrun">sensor.bndrun</a>
</p>

<div class="collapse" id="sensor.bndrun">
  <div class="card card-block">

<figure class="highlight"><pre><code class="language-properties" data-lang="properties"><span class="py">-runrequires</span><span class="p">:</span> <span class="se">\
</span>	<span class="s">bnd.identity;id='com.paremus.brain.iot.example.sensor.impl',</span><span class="se">\
</span>	<span class="s">bnd.identity;id='org.apache.aries.jax.rs.jackson'</span>
	
<span class="py">-runfw</span><span class="p">:</span> <span class="s">org.eclipse.osgi</span>
<span class="py">-runee</span><span class="p">:</span> <span class="s">JavaSE-1.8</span>

<span class="py">-runproperties</span><span class="p">:</span> <span class="s">org.osgi.service.http.port=8082</span>

<span class="py">-resolve.effective</span><span class="p">:</span> <span class="s">active</span>
<span class="py">-runbundles</span><span class="p">:</span> <span class="se">\
</span>	<span class="s">ch.qos.logback.classic;version='[1.2.3,1.2.4)',</span><span class="se">\
</span>	<span class="s">ch.qos.logback.core;version='[1.2.3,1.2.4)',</span><span class="se">\
</span>	<span class="s">com.paremus.brain.iot.eventing.api;version='[0.0.1,0.0.2)',</span><span class="se">\
</span>	<span class="s">com.paremus.brain.iot.eventing.impl;version='[0.0.1,0.0.2)',</span><span class="se">\
</span>	<span class="s">org.apache.aries.jax.rs.whiteboard;version='[1.0.1,1.0.2)',</span><span class="se">\
</span>	<span class="s">org.apache.felix.configadmin;version='[1.9.8,1.9.9)',</span><span class="se">\
</span>	<span class="s">org.apache.felix.http.jetty;version='[4.0.6,4.0.7)',</span><span class="se">\
</span>	<span class="s">org.apache.felix.http.servlet-api;version='[1.1.2,1.1.3)',</span><span class="se">\
</span>	<span class="s">org.apache.felix.scr;version='[2.1.10,2.1.11)',</span><span class="se">\
</span>	<span class="s">org.apache.servicemix.specs.annotation-api-1.3;version='[1.3.0,1.3.1)',</span><span class="se">\
</span>	<span class="s">org.osgi.service.jaxrs;version='[1.0.0,1.0.1)',</span><span class="se">\
</span>	<span class="s">org.osgi.util.function;version='[1.1.0,1.1.1)',</span><span class="se">\
</span>	<span class="s">org.osgi.util.promise;version='[1.1.0,1.1.1)',</span><span class="se">\
</span>	<span class="s">slf4j.api;version='[1.7.25,1.7.26)',</span><span class="se">\
</span>	<span class="s">com.fasterxml.jackson.core.jackson-annotations;version='[2.9.0,2.9.1)',</span><span class="se">\
</span>	<span class="s">com.fasterxml.jackson.core.jackson-core;version='[2.9.6,2.9.7)',</span><span class="se">\
</span>	<span class="s">com.fasterxml.jackson.core.jackson-databind;version='[2.9.6,2.9.7)',</span><span class="se">\
</span>	<span class="s">com.fasterxml.jackson.jaxrs.jackson-jaxrs-base;version='[2.9.6,2.9.7)',</span><span class="se">\
</span>	<span class="s">com.fasterxml.jackson.jaxrs.jackson-jaxrs-json-provider;version='[2.9.6,2.9.7)',</span><span class="se">\
</span>	<span class="s">com.fasterxml.jackson.module.jackson-module-jaxb-annotations;version='[2.9.6,2.9.7)',</span><span class="se">\
</span>	<span class="s">org.apache.aries.jax.rs.jackson;version='[1.0.2,1.0.3)',</span><span class="se">\
</span>	<span class="s">org.osgi.util.pushstream;version='[1.0.0,1.0.1)',</span><span class="se">\
</span>	<span class="s">org.apache.aries.javax.jax.rs-api;version='[1.0.1,1.0.2)',</span><span class="se">\
</span>	<span class="s">com.paremus.brain.iot.example.sensor.api;version='[0.0.1,0.0.2)',</span><span class="se">\
</span>	<span class="s">com.paremus.brain.iot.example.sensor.impl;version='[0.0.1,0.0.2)',</span><span class="se">\
</span>	<span class="s">com.paremus.brain.iot.message.integrity.api;version='[0.0.1,0.0.2)',</span><span class="se">\
</span>	<span class="s">com.paremus.brain.iot.message.integrity.insecure.impl;version='[0.0.1,0.0.2)'</span></code></pre></figure>

  </div>
</div>

<h4 id="sensor-rest-service-implementation">Sensor REST Service Implementation</h4>
<p>Create the directory <code class="language-plaintext highlighter-rouge">~/eventing-example/sensor.impl/src/main/resources</code> and copy the downloaded <code class="language-plaintext highlighter-rouge">sensor.impl/src/main/resources/static</code> folder which is the implementation of the sensor web page to the same place of current <code class="language-plaintext highlighter-rouge">sensor.impl</code> module (i.e. <code class="language-plaintext highlighter-rouge">~/eventing-example/sensor.impl/src/main/resources/static</code>).</p>

<div class="language-plaintext shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>~/eventing-example $ ls light.impl/src/main/resources/static
css  img  index.html  js  lib
</code></pre></div></div>
<p>Now the sensor smart behaviour is ready to be built using <code class="language-plaintext highlighter-rouge">mvn package</code> command as shown before.</p>

<h3 id="create-controller-implementation-module">Create Controller Implementation Module</h3>
<p>Go to <code class="language-plaintext highlighter-rouge">eventing-example</code> project directory, create the <code class="language-plaintext highlighter-rouge">behaviour.impl</code> module using the <a href="https://enroute.osgi.org/about/112-enRoute-Archetypes.html#the-ds-component-archetype" target="_blank">ds-component Archetype</a>:</p>

<div class="language-plaintext shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>~/eventing-example $ mvn archetype:generate \
     -DarchetypeGroupId=org.osgi.enroute.archetype \
     -DarchetypeArtifactId=ds-component \
     -DarchetypeVersion=7.0.0
</code></pre></div></div>
<p>with the following values:</p>

<div class="language-plaintext shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Define value for property 'groupId': com.paremus.brain.iot.example
Define value for property 'artifactId': behaviour.impl
Define value for property 'version' 1.0-SNAPSHOT: : 0.0.1-SNAPSHOT
Define value for property 'package' com.paremus.brain.iot.example.behaviour.impl: : 
Confirm properties configuration:
groupId: com.paremus.brain.iot.example
artifactId: behaviour.impl
version: 0.0.1-SNAPSHOT
package: com.paremus.brain.iot.example.behaviour.impl
 Y: :
</code></pre></div></div>
<h4 id="dependencies-4">Dependencies</h4>

<p>Replace the auto-genearted POM in this module with the following, specifially, the <code class="language-plaintext highlighter-rouge">light.api</code> and <code class="language-plaintext highlighter-rouge">sensor.api</code> bundles are its dependencies:</p>
<p>
  <a class="btn btn-primary" data-toggle="collapse" href="#behavior-pom" aria-expanded="false" aria-controls="behavior-pom">pom.xml</a>
</p>

<div class="collapse" id="behavior-pom">
  <div class="card card-block">

<figure class="highlight"><pre><code class="language-properties" data-lang="properties"><span class="err">&lt;?xml</span> <span class="py">version</span><span class="p">=</span><span class="s">"1.0"</span> <span class="s">encoding="UTF-8"?&gt;</span>
<span class="err">&lt;project</span> <span class="py">xmlns</span><span class="p">=</span><span class="s">"http://maven.apache.org/POM/4.0.0"</span> <span class="s">xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"&gt;</span>
    <span class="err">&lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;</span>
    <span class="err">&lt;parent&gt;</span>
    <span class="err">&lt;artifactId&gt;eventing-example&lt;/artifactId&gt;</span>
    <span class="err">&lt;groupId&gt;com.paremus.brain.iot.example&lt;/groupId&gt;</span>
    <span class="err">&lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt;</span>
  <span class="err">&lt;/parent&gt;</span>

    <span class="err">&lt;groupId&gt;com.paremus.brain.iot.example&lt;/groupId&gt;</span>
    <span class="err">&lt;artifactId&gt;behaviour.impl&lt;/artifactId&gt;</span>
    <span class="err">&lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt;</span>

    <span class="err">&lt;description&gt;The</span> <span class="err">behaviour.impl</span> <span class="err">DS</span> <span class="err">component</span> <span class="err">-</span> <span class="err">built</span> <span class="err">using</span> <span class="err">OSGi</span> <span class="err">enRoute</span> <span class="err">R7&lt;/description&gt;</span>

    <span class="err">&lt;dependencies&gt;</span>
        <span class="err">&lt;dependency&gt;</span>
            <span class="err">&lt;groupId&gt;org.osgi.enroute&lt;/groupId&gt;</span>
            <span class="err">&lt;artifactId&gt;osgi-api&lt;/artifactId&gt;</span>
            <span class="err">&lt;type&gt;pom&lt;/type&gt;</span>
        <span class="err">&lt;/dependency&gt;</span>
        <span class="err">&lt;dependency&gt;</span>
            <span class="err">&lt;groupId&gt;org.osgi.enroute&lt;/groupId&gt;</span>
            <span class="err">&lt;artifactId&gt;impl-index&lt;/artifactId&gt;</span>
            <span class="err">&lt;type&gt;pom&lt;/type&gt;</span>
        <span class="err">&lt;/dependency&gt;</span>
        <span class="err">&lt;dependency&gt;</span>
            <span class="err">&lt;groupId&gt;com.paremus.brain.iot.example&lt;/groupId&gt;</span>
            <span class="err">&lt;artifactId&gt;sensor.api&lt;/artifactId&gt;</span>
            <span class="err">&lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt;</span>
        <span class="err">&lt;/dependency&gt;</span>
        <span class="err">&lt;dependency&gt;</span>
            <span class="err">&lt;groupId&gt;com.paremus.brain.iot.example&lt;/groupId&gt;</span>
            <span class="err">&lt;artifactId&gt;light.api&lt;/artifactId&gt;</span>
            <span class="err">&lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt;</span>
        <span class="err">&lt;/dependency&gt;</span>
        <span class="err">&lt;dependency&gt;</span>
            <span class="err">&lt;groupId&gt;com.paremus.brain.iot&lt;/groupId&gt;</span>
            <span class="err">&lt;artifactId&gt;eventing.api&lt;/artifactId&gt;</span>
            <span class="err">&lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt;</span>
        <span class="err">&lt;/dependency&gt;</span>
        <span class="err">&lt;dependency&gt;</span>
            <span class="err">&lt;groupId&gt;org.osgi.enroute&lt;/groupId&gt;</span>
            <span class="err">&lt;artifactId&gt;test-bundles&lt;/artifactId&gt;</span>
            <span class="err">&lt;type&gt;pom&lt;/type&gt;</span>
        <span class="err">&lt;/dependency&gt;</span>
     <span class="err">&lt;/dependencies&gt;</span>

    <span class="err">&lt;build&gt;</span>
        <span class="err">&lt;plugins&gt;</span>
            <span class="err">&lt;</span><span class="c">!-- Expected to inherit configuration from a parent enRoute 
</span>                <span class="err">pom.</span> <span class="err">This</span> <span class="err">includes</span> <span class="err">-contract</span> <span class="err">definitions</span> <span class="err">and</span> <span class="err">maven-jar-plugin</span> <span class="err">setup</span> <span class="err">--&gt;</span>
            <span class="err">&lt;plugin&gt;</span>
                <span class="err">&lt;groupId&gt;biz.aQute.bnd&lt;/groupId&gt;</span>
                <span class="err">&lt;artifactId&gt;bnd-maven-plugin&lt;/artifactId&gt;</span>
            <span class="err">&lt;/plugin&gt;</span>
            <span class="err">&lt;plugin&gt;</span>
                <span class="err">&lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;</span>
                <span class="err">&lt;artifactId&gt;maven-jar-plugin&lt;/artifactId&gt;</span>
            <span class="err">&lt;/plugin&gt;</span>
            <span class="err">&lt;plugin&gt;</span>
                <span class="err">&lt;groupId&gt;com.paremus.brain.iot.maven&lt;/groupId&gt;</span>
                <span class="err">&lt;artifactId&gt;smart-behaviour-maven-plugin&lt;/artifactId&gt;</span>
                <span class="err">&lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt;</span>
                <span class="err">&lt;executions&gt;</span>
					<span class="err">&lt;execution&gt;</span>
						<span class="err">&lt;goals&gt;</span>
							<span class="err">&lt;goal&gt;smart-behaviour&lt;/goal&gt;</span>
						<span class="err">&lt;/goals&gt;</span>
					<span class="err">&lt;/execution&gt;</span>
				<span class="err">&lt;/executions&gt;</span>
            <span class="err">&lt;/plugin&gt;</span>
        <span class="err">&lt;/plugins&gt;</span>
    <span class="err">&lt;/build&gt;</span>
<span class="err">&lt;/project&gt;</span></code></pre></figure>

  </div>
</div>

<h4 id="implement-the-behaviourimpl-smart-behaviour">Implement the <code class="language-plaintext highlighter-rouge">behaviour.impl</code> smart behaviour</h4>
<p>Overwrite auto-generated <code class="language-plaintext highlighter-rouge">ComponentImpl.java</code> class in src package:</p>

<p><code class="language-plaintext highlighter-rouge">~/eventing-example/behaviour.impl/src/main/java/com/paremus/brain/iot/example/behaviour/impl/ComponentImpl.java</code></p>
<p>
  <a class="btn btn-primary" data-toggle="collapse" href="#ComponentImpl" aria-expanded="false" aria-controls="ComponentImpl.java">ComponentImpl.java</a>
</p>

<div class="collapse" id="ComponentImpl">
  <div class="card card-block">

<figure class="highlight"><pre><code class="language-properties" data-lang="properties"><span class="err">/*</span> <span class="err">Copyright</span> <span class="err">2019</span> <span class="err">Paremus,</span> <span class="err">Ltd</span> <span class="err">-</span> <span class="err">All</span> <span class="err">Rights</span> <span class="err">Reserved</span>
 <span class="err">*</span> <span class="err">Unauthorized</span> <span class="err">copying</span> <span class="err">of</span> <span class="err">this</span> <span class="err">file,</span> <span class="err">via</span> <span class="err">any</span> <span class="err">medium</span> <span class="err">is</span> <span class="err">strictly</span> <span class="err">prohibited</span>
 <span class="err">*</span> <span class="err">Proprietary</span> <span class="err">and</span> <span class="err">confidential</span>
 <span class="err">*/</span>
<span class="err">package</span> <span class="err">com.paremus.brain.iot.example.behaviour.impl;</span>

<span class="err">import</span> <span class="err">com.paremus.brain.iot.example.light.api.LightCommand;</span>
<span class="err">import</span> <span class="err">com.paremus.brain.iot.example.sensor.api.SensorReadingDTO;</span>
<span class="err">import</span> <span class="err">eu.brain.iot.eventing.annotation.SmartBehaviourDefinition;</span>
<span class="err">import</span> <span class="err">eu.brain.iot.eventing.api.EventBus;</span>
<span class="err">import</span> <span class="err">eu.brain.iot.eventing.api.SmartBehaviour;</span>
<span class="err">import</span> <span class="err">org.osgi.service.component.annotations.Activate;</span>
<span class="err">import</span> <span class="err">org.osgi.service.component.annotations.Component;</span>
<span class="err">import</span> <span class="err">org.osgi.service.component.annotations.Deactivate;</span>
<span class="err">import</span> <span class="err">org.osgi.service.component.annotations.Modified;</span>
<span class="err">import</span> <span class="err">org.osgi.service.component.annotations.Reference;</span>
<span class="err">import</span> <span class="err">org.osgi.service.metatype.annotations.AttributeDefinition;</span>
<span class="err">import</span> <span class="err">org.osgi.service.metatype.annotations.AttributeType;</span>
<span class="err">import</span> <span class="err">org.osgi.service.metatype.annotations.Designate;</span>
<span class="err">import</span> <span class="err">org.osgi.service.metatype.annotations.ObjectClassDefinition;</span>

<span class="err">import</span> <span class="err">java.util.concurrent.Executors;</span>
<span class="err">import</span> <span class="err">java.util.concurrent.ScheduledExecutorService;</span>
<span class="err">import</span> <span class="err">java.util.concurrent.TimeUnit;</span>
<span class="err">import</span> <span class="err">java.util.concurrent.atomic.AtomicInteger;</span>

<span class="err">/**</span>
 <span class="err">*</span> <span class="err">A</span> <span class="err">Smart</span> <span class="err">Behaviour</span> <span class="err">implementing</span> <span class="err">a</span> <span class="err">security</span> <span class="err">light</span> <span class="err">that</span> <span class="err">slowly</span> <span class="err">turns</span> <span class="err">off</span>
 <span class="err">*/</span>
<span class="err">@Component</span>
<span class="err">@SmartBehaviourDefinition(</span><span class="py">consumed</span> <span class="p">=</span> <span class="s">SensorReadingDTO.class, filter = "(timestamp=*)",</span>
        <span class="py">author</span> <span class="p">=</span> <span class="s">"Paremus", name = "Example Smart Security Light Behaviour",</span>
        <span class="py">description</span> <span class="p">=</span> <span class="s">"Implements a security light that slowly turns off.")</span>
<span class="err">@Designate(</span><span class="py">ocd</span> <span class="p">=</span> <span class="s">ComponentImpl.Config.class)</span>
<span class="err">public</span> <span class="err">class</span> <span class="err">ComponentImpl</span> <span class="err">implements</span> <span class="err">SmartBehaviour&lt;SensorReadingDTO&gt;</span> <span class="err">{</span>
    <span class="err">@ObjectClassDefinition(</span>
            <span class="py">name</span> <span class="p">=</span> <span class="s">"Smart Security Behaviour",</span>
            <span class="py">description</span> <span class="p">=</span> <span class="s">"Configuration for the Smart Security Behaviour."</span>
    <span class="err">)</span>
    <span class="err">@interface</span> <span class="err">Config</span> <span class="err">{</span>
        <span class="err">enum</span> <span class="err">LightColour</span> <span class="err">{</span>
            <span class="err">WHITE,</span> <span class="err">RED,</span> <span class="err">YELLOW,</span> <span class="err">MAGENTA,</span> <span class="err">GREEN,</span> <span class="err">BLUE,</span> <span class="err">CYAN</span>
        <span class="err">}</span>

        <span class="err">@AttributeDefinition(</span><span class="py">type</span> <span class="p">=</span> <span class="s">AttributeType.INTEGER,</span>
                <span class="py">name</span> <span class="p">=</span> <span class="s">"Time on",</span>
                <span class="py">description</span> <span class="p">=</span> <span class="s">"How long light stays on after sensor is triggered (seconds)",</span>
                <span class="py">min</span> <span class="p">=</span> <span class="s">"10",</span>
                <span class="py">max</span> <span class="p">=</span> <span class="s">"300"</span>
        <span class="err">)</span>
        <span class="err">int</span> <span class="err">duration()</span> <span class="err">default</span> <span class="err">10;</span>

        <span class="err">@AttributeDefinition(</span>
                <span class="py">name</span> <span class="p">=</span> <span class="s">"Colour",</span>
                <span class="py">description</span> <span class="p">=</span> <span class="s">"Colour light emits when activated"</span>
        <span class="err">)</span>
        <span class="err">LightColour</span> <span class="err">colour()</span> <span class="err">default</span> <span class="err">LightColour.WHITE;</span>
    <span class="err">}</span>

    <span class="err">private</span> <span class="err">final</span> <span class="err">int</span> <span class="py">MAX_BRIGHTNESS</span> <span class="p">=</span> <span class="s">10;</span>

	<span class="err">private</span> <span class="err">final</span> <span class="err">ScheduledExecutorService</span> <span class="py">worker</span> <span class="p">=</span> <span class="s">Executors.newSingleThreadScheduledExecutor();</span>

	<span class="err">private</span> <span class="err">final</span> <span class="err">AtomicInteger</span> <span class="py">brightness</span> <span class="p">=</span> <span class="s">new AtomicInteger();</span>

	<span class="err">@Reference</span>
	<span class="err">private</span> <span class="err">EventBus</span> <span class="err">eventBus;</span>

	<span class="err">private</span> <span class="err">Config</span> <span class="err">config;</span>

	<span class="err">@Activate</span>
	<span class="err">void</span> <span class="err">activate(Config</span> <span class="err">config)</span> <span class="err">{</span>
	    <span class="py">this.config</span> <span class="p">=</span> <span class="s">config;</span>
    <span class="err">}</span>

    <span class="err">@Modified</span>
    <span class="err">void</span> <span class="err">modify(Config</span> <span class="err">config)</span> <span class="err">{</span>
        <span class="py">this.config</span> <span class="p">=</span> <span class="s">config;</span>
    <span class="err">}</span>

	<span class="err">@Deactivate</span>
	<span class="err">void</span> <span class="err">stop()</span> <span class="err">{</span>
		<span class="err">worker.shutdown();</span>
	<span class="err">}</span>

	<span class="err">@Override</span>
	<span class="err">public</span> <span class="err">void</span> <span class="err">notify(SensorReadingDTO</span> <span class="err">event)</span> <span class="err">{</span>

		<span class="err">int</span> <span class="py">oldValue</span> <span class="p">=</span> <span class="s">brightness.getAndSet(MAX_BRIGHTNESS);</span>

		<span class="err">if(</span><span class="py">oldValue</span> <span class="p">=</span><span class="s">= 0) {</span>
			<span class="err">worker.execute(</span><span class="py">this</span><span class="p">:</span><span class="s">:updateBulb);</span>
		<span class="err">}</span>
	<span class="err">}</span>

	<span class="err">private</span> <span class="err">void</span> <span class="err">updateBulb()</span> <span class="err">{</span>
		<span class="err">int</span> <span class="py">value</span> <span class="p">=</span> <span class="s">brightness.getAndAccumulate(-1, (a,b) -&gt; Math.max(0, a + b));</span>

		<span class="err">LightCommand</span> <span class="py">command</span> <span class="p">=</span> <span class="s">new LightCommand();</span>
		<span class="py">command.brightness</span> <span class="p">=</span> <span class="s">value;</span>
		<span class="py">command.status</span> <span class="p">=</span> <span class="s">value &gt; 0;</span>

		<span class="err">eventBus.deliver(command);</span>

		<span class="err">if</span> <span class="err">(value</span> <span class="c">!= 0) {
</span>		    <span class="err">long</span> <span class="py">delayMs</span> <span class="p">=</span> <span class="s">config.duration() * 1000 / MAX_BRIGHTNESS;</span>
			<span class="err">worker.schedule(</span><span class="py">this</span><span class="p">:</span><span class="s">:updateBulb, delayMs, TimeUnit.MILLISECONDS);</span>
		<span class="err">}</span>
	<span class="err">}</span>
<span class="err">}</span></code></pre></figure>

  </div>
</div>

<p>Now the <code class="language-plaintext highlighter-rouge">behaviour.impl</code> smart behaviour is ready to be built using <code class="language-plaintext highlighter-rouge">mvn package</code> command as shown before.</p>

<h2 id="build-the-system">Build the System</h2>

<p>Now build and install all smart behaviours together from the parent root directory:</p>

<div class="language-plaintext shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>~/eventing-example $ mvn clean install

[INFO] Scanning for projects...
[INFO] Copying .....
[INFO] Processing ~/eventing-example/*/*.bndrun for dependencies
[INFO] Building jar: ~/eventing-example/light.impl/target/light.impl-0.0.1-SNAPSHOT-brain-iot-smart-behaviour.jar
[INFO] Installing ~/eventing-example/light.impl/target/light.impl-0.0.1-SNAPSHOT-brain-iot-smart-behaviour.jar to ~/.m2/repository/com/paremus/brain/iot/example/light.impl/0.0.1-SNAPSHOT/light.impl-0.0.1-SNAPSHOT-brain-iot-smart-behaviour.jar
......
[INFO] Building jar: ~/eventing-example/sensor.impl/target/sensor.impl-0.0.1-SNAPSHOT-brain-iot-smart-behaviour.jar
[INFO] Installing ~/eventing-example/sensor.impl/target/sensor.impl-0.0.1-SNAPSHOT-brain-iot-smart-behaviour.jar to ~/.m2/repository/com/paremus/brain/iot/example/sensor.impl/0.0.1-SNAPSHOT/sensor.impl-0.0.1-SNAPSHOT-brain-iot-smart-behaviour.jar
......
[INFO] Building jar: ~/eventing-example/behaviour.impl/target/behaviour.impl-0.0.1-SNAPSHOT-brain-iot-smart-behaviour.jar
[INFO] Installing ~/eventing-example/behaviour.impl/target/behaviour.impl-0.0.1-SNAPSHOT-brain-iot-smart-behaviour.jar to ~/.m2/repository/com/paremus/brain/iot/example/behaviour.impl/0.0.1-SNAPSHOT/behaviour.impl-0.0.1-SNAPSHOT-brain-iot-smart-behaviour.jar
[INFO] ------------------------------------------------------------------------
[INFO] BUILD SUCCESS
[INFO] ------------------------------------------------------------------------
</code></pre></div></div>
<p>As shown in the logs, finally there are three smart behaviurs generated in the implementation modules.</p>

<p class="note">The <code class="language-plaintext highlighter-rouge">install</code> goal will install the smart behaviors together with the OSGi bundles in Maven local repository (~/.m2), which will be used when creating the marketplace, as shown later in this page. Alternativly, the smart behaviours can be deployed to a respository server, and add this repository in the marketplace project.</p>

<p class="warning">If there is already a smart behaviour has been generated before rebuilding the project, remember to run the <code class="language-plaintext highlighter-rouge">clean</code> goal before the <code class="language-plaintext highlighter-rouge">package</code> goal to remove the existing <code class="language-plaintext highlighter-rouge">smart-behaviour</code> folder from the project <code class="language-plaintext highlighter-rouge">target</code> directory to avoid failure when copying the denpendencies.</p>

<h2 id="the-composite-application">The Composite Application</h2>
<p>We now pull these Modules together to create the Composite Application to test the whole system work well before deploying it to BRAIN-IoT Fabric.</p>

<p>In the <code class="language-plaintext highlighter-rouge">eventing-example</code> project directory, create the <code class="language-plaintext highlighter-rouge">single-framework-example</code> application module using the <a href="https://enroute.osgi.org/about/112-enRoute-Archetypes.html#the-application-archetype" target="_blank">application Archetype</a>:</p>

<div class="language-plaintext shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>~/eventing-example $ mvn archetype:generate \
     -DarchetypeGroupId=org.osgi.enroute.archetype \
     -DarchetypeArtifactId=application \
     -DarchetypeVersion=7.0.0
</code></pre></div></div>
<p>with the following values:</p>

<div class="language-plaintext shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Define value for property 'groupId': com.paremus.brain.iot.example
Define value for property 'artifactId': single-framework-example
Define value for property 'version' 1.0-SNAPSHOT: : 0.0.1-SNAPSHOT
Define value for property 'package' com.paremus.brain.iot.example: : 
Define value for property 'impl-artifactId': light.impl
Define value for property 'impl-groupId' com.paremus.brain.iot.example: : 
Define value for property 'impl-version' 0.0.1-SNAPSHOT: : 
[INFO] Using property: target-java-version = 8
Confirm properties configuration:
groupId: com.paremus.brain.iot.example
artifactId: single-framework-example
version: 0.0.1-SNAPSHOT
package: com.paremus.brain.iot.example
impl-artifactId: light.impl
impl-groupId: com.paremus.brain.iot.example
impl-version: 0.0.1-SNAPSHOT
target-java-version: 8
Y: :
</code></pre></div></div>
<h3 id="dependencies-5">Dependencies</h3>
<p>Replace the auto-genearted POM in this module with the following:
 the content is similar with the <code class="language-plaintext highlighter-rouge">light.impl</code> POM with the build configuartion:</p>
<p>
  <a class="btn btn-primary" data-toggle="collapse" href="#singleFW-pom" aria-expanded="false" aria-controls="singleFW-pom">pom.xml</a>
</p>

<div class="collapse" id="singleFW-pom">
  <div class="card card-block">

<figure class="highlight"><pre><code class="language-properties" data-lang="properties"><span class="err">&lt;?xml</span> <span class="py">version</span><span class="p">=</span><span class="s">"1.0"</span> <span class="s">encoding="UTF-8"?&gt;</span>
<span class="err">&lt;project</span> <span class="py">xmlns</span><span class="p">=</span><span class="s">"http://maven.apache.org/POM/4.0.0"</span> <span class="s">xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"&gt;</span>
    <span class="err">&lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;</span>
    <span class="err">&lt;parent&gt;</span>
    <span class="err">&lt;artifactId&gt;eventing-example&lt;/artifactId&gt;</span>
    <span class="err">&lt;groupId&gt;com.paremus.brain.iot.example&lt;/groupId&gt;</span>
    <span class="err">&lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt;</span>
  <span class="err">&lt;/parent&gt;</span>

    <span class="err">&lt;groupId&gt;com.paremus.brain.iot.example&lt;/groupId&gt;</span>
    <span class="err">&lt;artifactId&gt;single-framework-example&lt;/artifactId&gt;</span>
    <span class="err">&lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt;</span>

    <span class="err">&lt;description&gt;The</span> <span class="err">single-framework-example</span> <span class="err">application</span> <span class="err">packaging</span> <span class="err">project</span> <span class="err">-</span> <span class="err">using</span> <span class="err">OSGi</span> <span class="err">enRoute</span> <span class="err">R7&lt;/description&gt;</span>

    <span class="err">&lt;dependencies&gt;</span>
        <span class="err">&lt;dependency&gt;</span>
            <span class="err">&lt;groupId&gt;com.paremus.brain.iot.example&lt;/groupId&gt;</span>
            <span class="err">&lt;artifactId&gt;behaviour.impl&lt;/artifactId&gt;</span>
            <span class="err">&lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt;</span>
        <span class="err">&lt;/dependency&gt;</span>
        <span class="err">&lt;dependency&gt;</span>
            <span class="err">&lt;groupId&gt;com.paremus.brain.iot.example&lt;/groupId&gt;</span>
            <span class="err">&lt;artifactId&gt;light.impl&lt;/artifactId&gt;</span>
            <span class="err">&lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt;</span>
            <span class="err">&lt;scope&gt;runtime&lt;/scope&gt;</span>
        <span class="err">&lt;/dependency&gt;</span>
        <span class="err">&lt;dependency&gt;</span>
            <span class="err">&lt;groupId&gt;com.paremus.brain.iot.example&lt;/groupId&gt;</span>
            <span class="err">&lt;artifactId&gt;sensor.impl&lt;/artifactId&gt;</span>
            <span class="err">&lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt;</span>
            <span class="err">&lt;scope&gt;runtime&lt;/scope&gt;</span>
        <span class="err">&lt;/dependency&gt;</span>
        <span class="err">&lt;dependency&gt;</span>
            <span class="err">&lt;groupId&gt;com.paremus.brain.iot&lt;/groupId&gt;</span>
            <span class="err">&lt;artifactId&gt;eventing.impl&lt;/artifactId&gt;</span>
            <span class="err">&lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt;</span>
            <span class="err">&lt;scope&gt;runtime&lt;/scope&gt;</span>
        <span class="err">&lt;/dependency&gt;</span>
        <span class="err">&lt;dependency&gt;</span>
            <span class="err">&lt;groupId&gt;org.apache.aries.jax.rs&lt;/groupId&gt;</span>
            <span class="err">&lt;artifactId&gt;org.apache.aries.jax.rs.jackson&lt;/artifactId&gt;</span>
            <span class="err">&lt;version&gt;1.0.2&lt;/version&gt;</span>
            <span class="err">&lt;scope&gt;runtime&lt;/scope&gt;</span>
        <span class="err">&lt;/dependency&gt;</span>
        <span class="err">&lt;dependency&gt;</span>
            <span class="err">&lt;groupId&gt;org.osgi.enroute&lt;/groupId&gt;</span>
            <span class="err">&lt;artifactId&gt;osgi-api&lt;/artifactId&gt;</span>
            <span class="err">&lt;type&gt;pom&lt;/type&gt;</span>
        <span class="err">&lt;/dependency&gt;</span>
        <span class="err">&lt;dependency&gt;</span>
            <span class="err">&lt;groupId&gt;org.osgi.enroute&lt;/groupId&gt;</span>
            <span class="err">&lt;artifactId&gt;impl-index&lt;/artifactId&gt;</span>
            <span class="err">&lt;type&gt;pom&lt;/type&gt;</span>
        <span class="err">&lt;/dependency&gt;</span>
        <span class="err">&lt;dependency&gt;</span>
            <span class="err">&lt;groupId&gt;org.osgi.enroute&lt;/groupId&gt;</span>
            <span class="err">&lt;artifactId&gt;debug-bundles&lt;/artifactId&gt;</span>
            <span class="err">&lt;type&gt;pom&lt;/type&gt;</span>
        <span class="err">&lt;/dependency&gt;</span>
    <span class="err">&lt;/dependencies&gt;</span>

    <span class="err">&lt;build&gt;</span>
        <span class="err">&lt;plugins&gt;</span>
            <span class="err">&lt;plugin&gt;</span>
                <span class="err">&lt;groupId&gt;biz.aQute.bnd&lt;/groupId&gt;</span>
                <span class="err">&lt;artifactId&gt;bnd-maven-plugin&lt;/artifactId&gt;</span>
            <span class="err">&lt;/plugin&gt;</span>
            <span class="err">&lt;plugin&gt;</span>
                <span class="err">&lt;groupId&gt;biz.aQute.bnd&lt;/groupId&gt;</span>
                <span class="err">&lt;artifactId&gt;bnd-indexer-maven-plugin&lt;/artifactId&gt;</span>
                <span class="err">&lt;configuration&gt;</span>
                    <span class="err">&lt;includeJar&gt;true&lt;/includeJar&gt;</span>
                <span class="err">&lt;/configuration&gt;</span>
            <span class="err">&lt;/plugin&gt;</span>
            <span class="err">&lt;plugin&gt;</span>
                <span class="err">&lt;groupId&gt;biz.aQute.bnd&lt;/groupId&gt;</span>
                <span class="err">&lt;artifactId&gt;bnd-export-maven-plugin&lt;/artifactId&gt;</span>
                <span class="err">&lt;configuration&gt;</span>
                    <span class="err">&lt;bndruns&gt;</span>
                        <span class="err">&lt;bndrun&gt;single-framework-example.bndrun&lt;/bndrun&gt;</span>
                    <span class="err">&lt;/bndruns&gt;</span>
                <span class="err">&lt;/configuration&gt;</span>
            <span class="err">&lt;/plugin&gt;</span>
            <span class="err">&lt;plugin&gt;</span>
                <span class="err">&lt;groupId&gt;biz.aQute.bnd&lt;/groupId&gt;</span>
                <span class="err">&lt;artifactId&gt;bnd-resolver-maven-plugin&lt;/artifactId&gt;</span>
                <span class="err">&lt;configuration&gt;</span>
                    <span class="err">&lt;bndruns&gt;</span>
                        <span class="err">&lt;bndrun&gt;single-framework-example.bndrun&lt;/bndrun&gt;</span>
                        <span class="err">&lt;bndrun&gt;debug.bndrun&lt;/bndrun&gt;</span>
                    <span class="err">&lt;/bndruns&gt;</span>
                <span class="err">&lt;/configuration&gt;</span>
            <span class="err">&lt;/plugin&gt;</span>
        <span class="err">&lt;/plugins&gt;</span>
    <span class="err">&lt;/build&gt;</span>
<span class="err">&lt;/project&gt;</span></code></pre></figure>

  </div>
</div>
<p class="note">Apart from the <code class="language-plaintext highlighter-rouge">light.impl</code> bundle, the <code class="language-plaintext highlighter-rouge">sendor.impl</code> and the <code class="language-plaintext highlighter-rouge">behaviour.impl</code> bundles should also be the dependencies for the application module.</p>

<h3 id="define-runtime-entity">Define Runtime Entity</h3>

<p>Our Security Light System is composed of the following elements:</p>

<ul>
  <li>A light smart behaviour</li>
  <li>A sensor smart behaviour</li>
  <li>A behaviour controller smart behaviour</li>
  <li>JAX-RS whiteboard resources for web pages</li>
</ul>

<p>These dependencies are expressed as runtime Requirements in the <code class="language-plaintext highlighter-rouge">~/eventing-example/single-framework-example/single-framework-example.bndrun</code> file.</p>

<p>Overwrite the content of the <code class="language-plaintext highlighter-rouge">single-framework-example.bndrun</code> from:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>index: target/index.xml<span class="p">;</span><span class="nv">name</span><span class="o">=</span><span class="s2">"single-framework-example"</span>

<span class="nt">-standalone</span>: <span class="k">${</span><span class="nv">index</span><span class="k">}</span>

<span class="nt">-runrequires</span>: osgi.identity<span class="p">;</span>filter:<span class="o">=</span><span class="s1">'(osgi.identity=com.paremus.brain.iot.example.light.impl)'</span>
<span class="nt">-runfw</span>: org.eclipse.osgi
<span class="nt">-runee</span>: JavaSE-1.8

<span class="nt">-resolve</span>.effective: active
</code></pre></div></div>
<p>to:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>index: target/index.xml<span class="p">;</span><span class="nv">name</span><span class="o">=</span><span class="s2">"single-framework-example"</span>

<span class="nt">-standalone</span>: <span class="k">${</span><span class="nv">index</span><span class="k">}</span>

<span class="nt">-runrequires</span>: <span class="se">\</span>
	osgi.identity<span class="p">;</span>filter:<span class="o">=</span><span class="s1">'(osgi.identity=com.paremus.brain.iot.example.behaviour.impl)'</span>,<span class="se">\</span>
	bnd.identity<span class="p">;</span><span class="nb">id</span><span class="o">=</span><span class="s1">'com.paremus.brain.iot.example.light.impl'</span>,<span class="se">\</span>
	bnd.identity<span class="p">;</span><span class="nb">id</span><span class="o">=</span><span class="s1">'com.paremus.brain.iot.example.sensor.impl'</span>,<span class="se">\</span>
	bnd.identity<span class="p">;</span><span class="nb">id</span><span class="o">=</span><span class="s1">'org.apache.aries.jax.rs.jackson'</span>
<span class="nt">-runfw</span>: org.eclipse.osgi
<span class="nt">-runee</span>: JavaSE-1.8

<span class="nt">-resolve</span>.effective: active
</code></pre></div></div>

<p>Now build to generate the index, test index, and resolve this bndrun (you should be able to see the changes in the runbundles list afterwards). Then run whole system in the <code class="language-plaintext highlighter-rouge">eventing-example</code> root directory as done in the begining of this tutorial.</p>

<div class="language-plaintext shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>~/eventing-example $ cd single-framework-example
~/eventing-example/single-framework-example $ mvn bnd-indexer:index bnd-indexer:index@test-index bnd-resolver:resolve
~/eventing-example/single-framework-example $ cd ..
~/eventing-example $ mvn clean verify
~/eventing-example $ java -jar single-framework-example/target/single-framework-example.jar
</code></pre></div></div>
<p class="warning">If the <code class="language-plaintext highlighter-rouge">resolve</code> fails then check your code and try again. Once you can package it cleanly then continue to the next stage.</p>

<h2 id="create-a-marketplace">Create a Marketplace</h2>
<p>BRAIN-IoT provides the <code class="language-plaintext highlighter-rouge">behaviour-marketplace-maven-plugin</code> for creating a marketplace. A marketplace gathers and unpackages all smart behaviours jars of a system into the <code class="language-plaintext highlighter-rouge">marketplace</code> directory in project <code class="language-plaintext highlighter-rouge">target</code> folder. In addition, there are a <code class="language-plaintext highlighter-rouge">index.xml</code> will be generated for resolving the marketplace and a marketplace site <code class="language-plaintext highlighter-rouge">index.html</code> file.</p>

<p>The development of the Security Light System is done, here we’ll create a marketplace for it.</p>

<p>Create a minimal enRoute maven project <code class="language-plaintext highlighter-rouge">security-light-marketplace</code> at <code class="language-plaintext highlighter-rouge">HOME</code> folder using the <a href="https://enroute.osgi.org/about/112-enRoute-Archetypes.html#the-project-archetype" target="_blank">bare-project Archetype</a>:</p>

<div class="language-plaintext shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>~/eventing-example $ cd
~$ mvn archetype:generate \
     -DarchetypeGroupId=org.osgi.enroute.archetype \
     -DarchetypeArtifactId=project-bare \
     -DarchetypeVersion=7.0.0
</code></pre></div></div>
<p>with the following values:</p>

<div class="language-plaintext shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Define value for property 'groupId': com.paremus.brain.iot.marketplace
Define value for property 'artifactId': security-light-marketplace
Define value for property 'version' 1.0-SNAPSHOT: : 0.0.1-SNAPSHOT
Define value for property 'package' com.paremus.brain.iot.marketplace: : 
Confirm properties configuration:
groupId: com.paremus.brain.iot.marketplace
artifactId: security-light-marketplace
version: 0.0.1-SNAPSHOT
package: com.paremus.brain.iot.marketplace
Y: :
</code></pre></div></div>
<h3 id="dependencies-6">Dependencies</h3>
<p>Open pom and change the <code class="language-plaintext highlighter-rouge">&lt;bnd.version&gt;</code> to</p>
<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;bnd.version&gt;</span>5.1.2<span class="nt">&lt;/bnd.version&gt;</span>
</code></pre></div></div>
<p>Similar with the POM setup of <code class="language-plaintext highlighter-rouge">eventing.example</code> project above, append the following repositories in <code class="language-plaintext highlighter-rouge">&lt;repositories&gt;</code> section for downloading the BRAIN-IoT runtime dependencies:</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>        <span class="nt">&lt;repository&gt;</span>
            <span class="nt">&lt;id&gt;</span>brain-iot-releases<span class="nt">&lt;/id&gt;</span>
            <span class="nt">&lt;name&gt;</span>BRAIN-IoT Releases<span class="nt">&lt;/name&gt;</span>
            <span class="nt">&lt;url&gt;</span>https://nexus.repository-pert.ismb.it/repository/maven-releases/<span class="nt">&lt;/url&gt;</span>
            <span class="nt">&lt;releases&gt;</span>
                <span class="nt">&lt;enabled&gt;</span>true<span class="nt">&lt;/enabled&gt;</span>
            <span class="nt">&lt;/releases&gt;</span>
            <span class="nt">&lt;snapshots&gt;</span>
                <span class="nt">&lt;enabled&gt;</span>false<span class="nt">&lt;/enabled&gt;</span>
            <span class="nt">&lt;/snapshots&gt;</span>
        <span class="nt">&lt;/repository&gt;</span>
        <span class="nt">&lt;repository&gt;</span>
            <span class="nt">&lt;id&gt;</span>brain-iot-snapshots<span class="nt">&lt;/id&gt;</span>
            <span class="nt">&lt;name&gt;</span>BRAIN-IoT Snapshots<span class="nt">&lt;/name&gt;</span>
            <span class="nt">&lt;url&gt;</span>https://nexus.repository-pert.ismb.it/repository/maven-snapshots/<span class="nt">&lt;/url&gt;</span>
            <span class="nt">&lt;releases&gt;</span>
                <span class="nt">&lt;enabled&gt;</span>false<span class="nt">&lt;/enabled&gt;</span>
            <span class="nt">&lt;/releases&gt;</span>
            <span class="nt">&lt;snapshots&gt;</span>
                <span class="nt">&lt;enabled&gt;</span>true<span class="nt">&lt;/enabled&gt;</span>
            <span class="nt">&lt;/snapshots&gt;</span>
        <span class="nt">&lt;/repository&gt;</span>
</code></pre></div></div>
<p>and append the following plugin repositories in <code class="language-plaintext highlighter-rouge">&lt;pluginRepositories&gt;</code> section for downloading the BRAIN-IoT <code class="language-plaintext highlighter-rouge">behaviour-marketplace-maven-plugin</code>:</p>
<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>        <span class="nt">&lt;pluginRepository&gt;</span>
            <span class="nt">&lt;id&gt;</span>brain-iot-releases<span class="nt">&lt;/id&gt;</span>
            <span class="nt">&lt;name&gt;</span>BRAIN-IoT Releases<span class="nt">&lt;/name&gt;</span>
            <span class="nt">&lt;url&gt;</span>https://nexus.repository-pert.ismb.it/repository/maven-releases/<span class="nt">&lt;/url&gt;</span>
            <span class="nt">&lt;releases&gt;</span>
                <span class="nt">&lt;enabled&gt;</span>true<span class="nt">&lt;/enabled&gt;</span>
            <span class="nt">&lt;/releases&gt;</span>
            <span class="nt">&lt;snapshots&gt;</span>
                <span class="nt">&lt;enabled&gt;</span>false<span class="nt">&lt;/enabled&gt;</span>
            <span class="nt">&lt;/snapshots&gt;</span>
        <span class="nt">&lt;/pluginRepository&gt;</span>
        <span class="nt">&lt;pluginRepository&gt;</span>
            <span class="nt">&lt;id&gt;</span>brain-iot-snapshots<span class="nt">&lt;/id&gt;</span>
            <span class="nt">&lt;name&gt;</span>BRAIN-IoT Snapshots<span class="nt">&lt;/name&gt;</span>
            <span class="nt">&lt;url&gt;</span>https://nexus.repository-pert.ismb.it/repository/maven-snapshots/<span class="nt">&lt;/url&gt;</span>
            <span class="nt">&lt;releases&gt;</span>
                <span class="nt">&lt;enabled&gt;</span>false<span class="nt">&lt;/enabled&gt;</span>
            <span class="nt">&lt;/releases&gt;</span>
            <span class="nt">&lt;snapshots&gt;</span>
                <span class="nt">&lt;enabled&gt;</span>true<span class="nt">&lt;/enabled&gt;</span>
            <span class="nt">&lt;/snapshots&gt;</span>
        <span class="nt">&lt;/pluginRepository&gt;</span>
</code></pre></div></div>
<p>Then create the new <code class="language-plaintext highlighter-rouge">&lt;dependencies&gt;</code> section and add the <code class="language-plaintext highlighter-rouge">light.iml</code>, <code class="language-plaintext highlighter-rouge">sensor.impl</code>, <code class="language-plaintext highlighter-rouge">behaviour.impl</code> OSGi artifacts:</p>
<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="nt">&lt;dependencies&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>com.paremus.brain.iot.example<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>behaviour.impl<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;version&gt;</span>0.0.1-SNAPSHOT<span class="nt">&lt;/version&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>com.paremus.brain.iot.example<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>light.impl<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;version&gt;</span>0.0.1-SNAPSHOT<span class="nt">&lt;/version&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>com.paremus.brain.iot.example<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>sensor.impl<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;version&gt;</span>0.0.1-SNAPSHOT<span class="nt">&lt;/version&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
    <span class="nt">&lt;/dependencies&gt;</span>
</code></pre></div></div>
<h3 id="build-1">Build</h3>
<p>Create the new <code class="language-plaintext highlighter-rouge">&lt;build&gt;</code> section and add the <code class="language-plaintext highlighter-rouge">behaviour-marketplace-maven-plugin</code> plugin to build the marketplace:</p>
<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="nt">&lt;build&gt;</span>
        <span class="nt">&lt;plugins&gt;</span>
            <span class="nt">&lt;plugin&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>com.paremus.brain.iot.maven<span class="nt">&lt;/groupId&gt;</span>
				<span class="nt">&lt;artifactId&gt;</span>behaviour-marketplace-maven-plugin<span class="nt">&lt;/artifactId&gt;</span>
				<span class="nt">&lt;version&gt;</span>0.0.1-SNAPSHOT<span class="nt">&lt;/version&gt;</span>
				<span class="nt">&lt;configuration&gt;</span>
				<span class="nt">&lt;/configuration&gt;</span>
				<span class="nt">&lt;executions&gt;</span>
					<span class="nt">&lt;execution&gt;</span>
						<span class="nt">&lt;goals&gt;</span>
							<span class="nt">&lt;goal&gt;</span>generate<span class="nt">&lt;/goal&gt;</span>
						<span class="nt">&lt;/goals&gt;</span>
					<span class="nt">&lt;/execution&gt;</span>
				<span class="nt">&lt;/executions&gt;</span>
            <span class="nt">&lt;/plugin&gt;</span>
        <span class="nt">&lt;/plugins&gt;</span>
    <span class="nt">&lt;/build&gt;</span>
</code></pre></div></div>

<div class="language-plaintext shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>~ $ cd security-light-marketplace
~/security-light-marketplace $ mvn package
[INFO] Scanning for projects...                                                                        
[INFO] ------------------------------------------------------------------------
[INFO] Building security-light-marketplace 0.0.1-SNAPSHOT
[INFO] ------------------------------------------------------------------------
[INFO] --- behaviour-marketplace-maven-plugin:0.0.1-SNAPSHOT:generate (default) @ security-light-marketplace ---
......
[INFO] Unpacking ~/.m2/repository/com/paremus/brain/iot/example/behaviour.impl/0.0.1-SNAPSHOT/behaviour.impl-0.0.1-SNAPSHOT-brain-iot-smart-behaviour.jar to ~/security-light-marketplace/target/marketplace/behaviour.impl-0.0.1-SNAPSHOT-brain-iot-smart-behaviour-jar ......
[INFO] Unpacking ~/.m2/repository/com/paremus/brain/iot/example/light.impl/0.0.1-SNAPSHOT/light.impl-0.0.1-SNAPSHOT-brain-iot-smart-behaviour.jar to ~/security-light-marketplace/target/marketplace/light.impl-0.0.1-SNAPSHOT-brain-iot-smart-behaviour-jar ......
[INFO] Unpacking ~/.m2/repository/com/paremus/brain/iot/example/sensor.impl/0.0.1-SNAPSHOT/sensor.impl-0.0.1-SNAPSHOT-brain-iot-smart-behaviour.jar to ~/security-light-marketplace/target/marketplace/sensor.impl-0.0.1-SNAPSHOT-brain-iot-smart-behaviour-jar ......
[INFO] ------------------------------------------------------------------------
[INFO] BUILD SUCCESS
[INFO] ------------------------------------------------------------------------
</code></pre></div></div>
<p class="note">The logs indicated that the smart behaviours are unpacked from the maven local Repo (~/.m2) to the <code class="language-plaintext highlighter-rouge">target</code> directory folder</p>

<p>Enter the <code class="language-plaintext highlighter-rouge">target</code> folder and check the geenrated marketplace:</p>

<div class="language-plaintext shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>~/security-light-marketplace $ ls target/marketplace
behaviour.impl-0.0.1-SNAPSHOT-brain-iot-smart-behaviour-jar  light.impl-0.0.1-SNAPSHOT-brain-iot-smart-behaviour-jar
index.html                                                   sensor.impl-0.0.1-SNAPSHOT-brain-iot-smart-behaviour-jar
index.xml
</code></pre></div></div>
<p>To make the marketplace index available for configuring the Behaviour Management Service from the BRAIN-IoT UI as shown in the <a href="05-quickstart.html">Quick Start</a> tutorial, the marketplace site has to be deployed to a HTTP server. The marketplace index will be also used to create a <code class="language-plaintext highlighter-rouge">system document</code> as shown in next <a href="20-distributed.html">Destributed Deployment</a> tutorial.</p>

<h3 id="deploy-marketplace-to-a-local-http-server">Deploy Marketplace to a Local HTTP server</h3>

<p>Copy the <code class="language-plaintext highlighter-rouge">marketplace</code> folder from <code class="language-plaintext highlighter-rouge">target</code> directory to the root of the HTTP server, the marketplace index is <code class="language-plaintext highlighter-rouge">https://localhost/marketplace/index.xml</code></p>

<div class="language-plaintext shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>~/security-light-marketplace $ sudo cp -rf target/marketplace /var/www/html
~/security-light-marketplace $ ls /var/www/html
marketplace
</code></pre></div></div>
<h3 id="deploy-to-a-nexus-server">Deploy to a Nexus server</h3>
<p>The Security Light Marketplace is now deployed on the BRAIN-IoT Nexus server. Open the <code class="language-plaintext highlighter-rouge">security-light-marketplace</code> POM, then</p>

<p>Add new <code class="language-plaintext highlighter-rouge">&lt;distributionManagement&gt;</code> section, then add the site URL:</p>
<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>	<span class="nt">&lt;distributionManagement&gt;</span>
		<span class="nt">&lt;site&gt;</span>
			<span class="nt">&lt;id&gt;</span>brain-iot-nexus-marketplace<span class="nt">&lt;/id&gt;</span>
			<span class="nt">&lt;url&gt;</span>dav:https://nexus.repository-pert.ismb.it/repository/marketplaces/${project.groupId}/${project.artifactId}/${project.version}<span class="nt">&lt;/url&gt;</span>
		<span class="nt">&lt;/site&gt;</span>
	<span class="nt">&lt;/distributionManagement&gt;</span>
</code></pre></div></div>
<p>Append the <code class="language-plaintext highlighter-rouge">org.apache.maven.plugins:maven-site-plugin</code> in the <code class="language-plaintext highlighter-rouge">&lt;build&gt;</code> section to deploy the the generated site to site URL specified in pom:</p>
<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>            <span class="nt">&lt;plugin&gt;</span>
                <span class="nt">&lt;artifactId&gt;</span>maven-site-plugin<span class="nt">&lt;/artifactId&gt;</span>
                <span class="nt">&lt;version&gt;</span>3.4<span class="nt">&lt;/version&gt;</span>
                <span class="nt">&lt;dependencies&gt;</span>
                    <span class="nt">&lt;dependency&gt;</span>
                        <span class="nt">&lt;groupId&gt;</span>org.apache.maven.wagon<span class="nt">&lt;/groupId&gt;</span>
                        <span class="nt">&lt;artifactId&gt;</span>wagon-webdav-jackrabbit<span class="nt">&lt;/artifactId&gt;</span>
                        <span class="nt">&lt;version&gt;</span>2.8<span class="nt">&lt;/version&gt;</span>
                    <span class="nt">&lt;/dependency&gt;</span>
                <span class="nt">&lt;/dependencies&gt;</span>
                <span class="nt">&lt;configuration&gt;</span>
                    <span class="nt">&lt;skip&gt;</span>true<span class="nt">&lt;/skip&gt;</span>
                    <span class="nt">&lt;inputDirectory&gt;</span>${project.build.directory}/marketplace<span class="nt">&lt;/inputDirectory&gt;</span>
                <span class="nt">&lt;/configuration&gt;</span>
            <span class="nt">&lt;/plugin&gt;</span>
</code></pre></div></div>
<p>Run the following command to deploy the site:</p>

<div class="language-plaintext shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>~/security-light-marketplace $ mvn clean verify site:deploy
</code></pre></div></div>
<p>After deployment is successful, then the marketplace index <code class="language-plaintext highlighter-rouge">https://nexus.repository-pert.ismb.it/repository/marketplaces/com.paremus.brain.iot.example/security-light-marketplace/0.0.1-SNAPSHOT/index.xml</code> is avilable.</p>

<h2 id="end">End</h2>

<p>That completes this tutorial.</p>


        </article>

      <!--</div>-->
        <hr />
        <a class=nav-prev href="05-quickstart.html" >Prev</a>
        <a class=nav-next href="20-distributed.html" >Next</a>

    </div>
</div>
</div>

        <!--/div-->
      </div>

      <footer class="site-footer">

<nav class=next-prev>
        <a href='/tutorial/05-quickstart.html'></a> <a href='/tutorial/20-distributed.html'></a>
</nav>

<script>
$(function() {
  return $("h2, h3, h4, h5, h6").each(function(i, el) {
    var $el, icon, id;
    $el = $(el);
    id = $el.attr('id');
    icon = '<i class="fa fa-link"></i>';
    if (id) {
      return $el.prepend($("<a />").addClass("header-link").attr("href", "#" + id).html(icon));
    }
  });
});
</script>

</footer>

    </div>

    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>

    <!-- Latest compiled and minified JavaScript -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

    <!-- MathJax -->
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

    <script type="text/javascript">
    $('body').scrollspy({
        target: '.bs-docs-sidebar',
        offset: 150 /* fixed header is about 40px high */
    });
    </script>

  </body>

</html>
